# テストシナリオ - Public Alpha

> 最終更新: 2025-12-19

VRC Shift Scheduler の機能を網羅的にテストするためのシナリオ集です。

## テスト目的

- 正常系の動作確認
- 異常系・エッジケースの検証
- マルチテナント境界の確認
- 同時実行時の競合制御の確認

---

## シナリオA: 基本フロー（正常系）

### 目的
アプリケーションの基本的な使い方を確認する。

### 前提条件
- データベースがリセットされている
- シードデータが投入されている
- ブラウザのローカルストレージがクリアされている

### 手順

1. **ログイン**
   - [ ] メールアドレス「admin@example.com」、パスワード「password123」でログイン
   - [ ] ダッシュボードまたはイベント一覧画面に遷移することを確認

2. **イベント作成**
   - [ ] サイドメニューから「イベント」をクリック
   - [ ] 「新しいイベント」ボタンをクリック
   - [ ] イベント名「テストイベント」、説明「Alpha版テスト」を入力
   - [ ] 作成ボタンをクリック
   - [ ] イベント一覧に新しいイベントが表示されることを確認

3. **営業日追加**
   - [ ] 作成したイベントをクリック
   - [ ] 「営業日を追加」ボタンをクリック
   - [ ] 日付「明日」、時刻「21:00-23:30」を入力
   - [ ] 営業日一覧に追加されることを確認

4. **シフト枠作成**
   - [ ] 作成した営業日をクリック
   - [ ] 「シフト枠を追加」ボタンをクリック
   - [ ] ポジション選択、必要人数「2」を入力
   - [ ] シフト枠一覧に表示されることを確認
   - [ ] 割り当て状況が「0/2」と表示されることを確認

5. **メンバー登録**
   - [ ] サイドメニューから「メンバー」をクリック
   - [ ] 「新規登録」ボタンをクリック
   - [ ] 表示名「テストメンバー」を入力
   - [ ] メンバー一覧に登録されることを確認

6. **シフト割り当て**
   - [ ] シフト枠の「割り当て」ボタンをクリック
   - [ ] メンバープルダウンから「テストメンバー」を選択
   - [ ] 確定ボタンをクリック
   - [ ] 割り当て状況が「1/2」に更新されることを確認

### 期待結果
- すべての操作がエラーなく完了する
- データが正しく保存・表示される
- 画面遷移がスムーズである

---

## シナリオB: 満員チェック（異常系）

### 目的
シフト枠の必要人数を超える割り当てが防止されることを確認する。

### 前提条件
- シナリオAが完了している
- シフト枠（必要人数2）に1人割り当て済み

### 手順

1. **2人目を割り当て**
   - [ ] 別のメンバー「テストメンバー2」を登録
   - [ ] シフト枠に「テストメンバー2」を割り当て
   - [ ] 割り当て状況が「2/2」になることを確認

2. **3人目を割り当て（エラー）**
   - [ ] 別のメンバー「テストメンバー3」を登録
   - [ ] 同じシフト枠に「テストメンバー3」を割り当てようとする
   - [ ] **期待**: エラーメッセージ「このシフト枠は既に満員です」が表示される
   - [ ] **期待**: 割り当てが失敗し、状態が「2/2」のまま

### 期待結果
- 必要人数を超える割り当ては拒否される
- 適切なエラーメッセージが表示される
- 既存の割り当てに影響がない

---

## シナリオC: 同時確定の競合（同時実行）

### 目的
複数人が同じシフト枠に同時に割り当てようとしたときの競合制御を確認する。

### 前提条件
- シフト枠（必要人数1）が作成されている
- 3人のメンバーが登録されている

### 手順

1. **3つのブラウザを開く**
   - [ ] ブラウザ1: メンバーAを割り当て準備
   - [ ] ブラウザ2: メンバーBを割り当て準備
   - [ ] ブラウザ3: メンバーCを割り当て準備

2. **同時に確定ボタンをクリック**
   - [ ] 3つのブラウザで「ほぼ同時に」確定ボタンをクリック
   - [ ] **期待**: 1人だけ成功し、2人は「満員です」エラーが出る
   - [ ] **期待**: シフト枠の状態が「1/1」になる

3. **確認**
   - [ ] データベースに1件だけ割り当てが保存されていることを確認
   - [ ] 成功したメンバーのみにシフトが割り当てられている

### 期待結果
- データベースの整合性が保たれる
- `SELECT ... FOR UPDATE` による排他制御が機能している
- 競合が適切にハンドリングされる

---

## シナリオD: 深夜営業（日またぎ）

### 目的
深夜帯（日付をまたぐ営業時間）の表示と動作を確認する。

### 前提条件
- イベントが作成されている

### 手順

1. **深夜営業日を作成**
   - [ ] 営業日: 2025-12-10
   - [ ] 開始時刻: 21:00
   - [ ] 終了時刻: 02:00（翌日）
   - [ ] **期待**: 営業日が正しく保存される

2. **深夜シフト枠を作成**
   - [ ] シフト枠名「深夜配信」
   - [ ] 開始時刻: 23:00
   - [ ] 終了時刻: 01:00（翌日）
   - [ ] **期待**: シフト枠が正しく表示される
   - [ ] **期待**: `is_overnight` フラグが `true` になっている

3. **表示確認**
   - [ ] UI で時刻が正しく表示される（例: 23:00-01:00）
   - [ ] シフト割り当て時に日付が正しく表示される

### 期待結果
- 日またぎの時刻が正しく処理される
- UI で混乱なく表示される
- データベースに正しく保存される

---

## シナリオE: マルチテナント境界（セキュリティ）

### 目的
異なるテナントのデータが混ざらないことを確認する。

### 前提条件
- 2つの異なるテナントのアカウントが存在する

### 手順

1. **テナントAでデータ作成**
   - [ ] テナントAの管理者でログイン
   - [ ] イベント「イベントA」を作成
   - [ ] メンバー「ユーザーA1」を登録

2. **テナントBでデータ作成**
   - [ ] ログアウト
   - [ ] テナントBの管理者でログイン
   - [ ] イベント「イベントB」を作成
   - [ ] メンバー「ユーザーB1」を登録

3. **境界確認**
   - [ ] テナントBのイベント一覧に「イベントA」が **表示されない** ことを確認
   - [ ] テナントBのメンバー一覧に「ユーザーA1」が **表示されない** ことを確認
   - [ ] 逆も同様に確認

4. **不正アクセス試行（手動APIテスト）**
   - [ ] テナントAでログイン
   - [ ] API（curl等）でテナントBのイベントIDを指定してアクセス
   - [ ] **期待**: `404 Not Found` または `403 Forbidden` が返される

### 期待結果
- 異なるテナントのデータは完全に分離されている
- `X-Tenant-ID` ヘッダーが正しく機能している
- 不正アクセスが防止されている

---

## シナリオF: バリデーションエラー（入力チェック）

### 目的
不正な入力がサーバー側で適切にバリデーションされることを確認する。

### 手順

1. **空文字入力**
   - [ ] イベント名を空白にして作成
   - [ ] **期待**: 「イベント名は必須です」エラー

2. **不正な時刻入力**
   - [ ] 開始時刻「25:00」（存在しない時刻）
   - [ ] **期待**: 「時刻の形式が不正です」エラー

3. **開始時刻 > 終了時刻**
   - [ ] 開始時刻「22:00」、終了時刻「21:00」
   - [ ] **期待**: 「開始時刻は終了時刻より前である必要があります」エラー

4. **必要人数が0以下**
   - [ ] 必要人数「0」または「-1」
   - [ ] **期待**: 「必要人数は1以上である必要があります」エラー

### 期待結果
- フロントエンドとバックエンドの両方でバリデーションが機能している
- 適切なエラーメッセージが表示される
- 不正なデータがデータベースに保存されない

---

## シナリオG: 出欠確認（公開URL）

### 目的
出欠確認の作成と公開URLでの回答機能を確認する。

### 手順

1. **出欠確認の作成**
   - [ ] サイドメニューから「出欠確認」をクリック
   - [ ] 「新規作成」ボタンをクリック
   - [ ] タイトル、説明、対象イベントを入力
   - [ ] 作成ボタンをクリック
   - [ ] 出欠確認が一覧に表示されることを確認

2. **公開URLの確認**
   - [ ] 作成した出欠確認の詳細を開く
   - [ ] 公開URLをコピー
   - [ ] シークレットウィンドウで公開URLにアクセス
   - [ ] **期待**: 認証なしで回答画面が表示される

3. **回答の送信**
   - [ ] 参加状況を選択
   - [ ] 回答ボタンをクリック
   - [ ] **期待**: 回答が正しく保存される

4. **回答の確認（管理画面）**
   - [ ] 管理者画面で出欠確認の詳細を開く
   - [ ] 回答一覧に送信した回答が表示されることを確認

### 期待結果
- 公開URLで認証なしにアクセスできる
- 回答が正しく保存・表示される
- 締切管理が機能している

---

## シナリオH: 日程調整（公開URL）

### 目的
日程調整の作成と公開URLでの回答機能を確認する。

### 手順

1. **日程調整の作成**
   - [ ] サイドメニューから「日程調整」をクリック
   - [ ] 「新規作成」ボタンをクリック
   - [ ] タイトル、説明、候補日を入力
   - [ ] 作成ボタンをクリック

2. **公開URLでの回答**
   - [ ] 公開URLをコピー
   - [ ] シークレットウィンドウで公開URLにアクセス
   - [ ] 各候補日への参加可否を選択
   - [ ] 回答ボタンをクリック

3. **回答の確認**
   - [ ] 管理者画面で回答一覧を確認
   - [ ] 集計結果が正しいことを確認

### 期待結果
- 候補日の設定ができる
- 公開URLで回答できる
- 回答の集計が正しく表示される

---

## テスト進捗チェックリスト

### 基本機能
- [ ] シナリオA: 基本フロー
- [ ] シナリオB: 満員チェック
- [ ] シナリオF: バリデーションエラー

### 高度な機能
- [ ] シナリオC: 同時確定の競合
- [ ] シナリオD: 深夜営業
- [ ] シナリオE: マルチテナント境界

### 公開ページ機能
- [ ] シナリオG: 出欠確認
- [ ] シナリオH: 日程調整

### その他
- [ ] ブラウザ互換性テスト（Chrome, Firefox, Safari）
- [ ] モバイル表示テスト
- [ ] ネットワーク遅延時の動作確認

---

## バグ報告

テスト中に見つけたバグは、[quickstart.md](./quickstart.md) に記載されている方法で報告してください。

---

**作成日**: 2025-12-19
**更新者**: ドキュメント検証
