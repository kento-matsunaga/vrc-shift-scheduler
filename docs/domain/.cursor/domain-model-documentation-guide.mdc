---
description: ドメインモデルドキュメント作成ガイドライン - VRC Shift Scheduler（VRChatイベント向けシフト調整SaaS）のドメインモデルドキュメント作成テンプレート
globs: **/*ドメインモデル*.md
---
このファイルを読み込んだら "VERIFICATION: Rule vrc-domain-model-documentation-guide.mdc activated for [filename]" と最初に出力し、このルールが読み込まれたことを示すこと。

# ドメインモデルドキュメント作成ガイドライン

> 💡 **関連ガイドライン**: ドメインモデル設計については @domain-modeling-guide.mdc を参照すること  

## 概要

このガイドラインは、**VRC Shift Scheduler** における各ドメインモジュール  
（テナント、イベント、営業日・営業枠、メンバー、シフト希望・シフト確定、通知 など）に対する  
**ドメインモデルドキュメント**の標準的な構成とフォーマットを定義する。

### ドメインモデル文書の目的

1. **ドメイン概念の明確化**  
   VRChatイベントのシフト調整業務を表現するドメインモデル（エンティティ、値オブジェクト、集約）の構造を、理解しやすく文書化する。

2. **実装パターンの可視化**  
   設計されたドメインモデルを、保守性と可読性の高いドキュメントとして出力し、  
   `internal/domain/*` 以下の Go 実装との対応関係を明らかにする。

3. **業務知識と実装の橋渡し**  
   「業務知識.md」で定義された業務ルールを、どのドメイン概念（集約・VO 等）で実現するかを明示し、  
   実装時の迷いを減らす。

### 業務知識文書との関係

**業務知識文書（*業務知識.md）が主であり、ドメインモデル文書はそれを実現する手段である。**

- 業務知識文書: 「何をすべきか（業務ルール・制約・判定条件）」を定義【主】
- ドメインモデル文書: 「それをどのドメイン概念で実現するか（エンティティ・値オブジェクト・集約）」を定義【手段】
- Mermaid クラス図と文章で、「業務ルールをコードとして表現する設計」を可視化する

**重要**: 業務知識が変われば、ドメインモデルの設計も変わる。  
常に `*業務知識.md` を基準として、ドメイン概念を決定すること。

## 使用場面の明確化

- **設計フェーズ**: @domain-modeling-guide.mdc（ドメインモデルの設計手法）
- **文書化フェーズ**: 本ガイドライン（設計済みモデルの文書化）

## 指示内容

設計済みのドメインモデルを、保守性・可読性の高いドキュメントとして出力するためのガイドラインである。  
VRC Shift Scheduler の実際の使用例（例: シトロン通常営業＋特別営業のシフト調整）を意識しつつ、  
必要な概念にフォーカスした効率的な文書化を行う。

---

## 標準出力フォーマット

ドメインモデルドキュメント作成時は、以下の構造に従って成果物を作成すること。

### 1. 概要セクション

- ドメインの目的と責務を3〜5行で説明
- 主要な集約ルートと値オブジェクトの概観
  - 例: 「シフト集約」「イベント集約」「メンバー集約」「通知集約」など

### 2. 主要な概念セクション

- **重要**: 全てのクラスを説明する必要はない
- **対象**:  
  - 集約ルート  
  - 第一級コレクション  
  - 区分オブジェクト（例: イベント種別、営業ステータス、シフト状態 など）  
  など、**業務的に重要な概念のみ**に絞る
- 各概念の責務を最大3行で簡潔に説明
  - 業務的な意味（何を表すか）
  - 技術的な責務（どのような不変条件を守るか）

### 3. 理解が困難な概念の詳細説明セクション（必要に応じて）

- 区分オブジェクトの具体的な種類と分類基準
  - 例: イベント種別（通常営業／特別営業／コラボイベント など）
  - 例: シフト状態（希望受付中／確定／キャンセル など）
- 複雑なビジネスルールや計算ロジック
  - 例: 連続シフト時間の上限、深夜帯の扱い など
- 特殊な制約条件や関係性
- 具体例やパターンによる説明

### 4. 関係性の説明セクション（必要に応じて）

- 複雑な階層構造がある場合の関係性説明
  - 例: テナント → イベント → イベント営業日 → 営業枠 → シフト希望／シフト確定
- 「設定／レコード／履歴」のような階層構造がある場合、その構造をテキストで説明
- 具体例を用いた構造の可視化（ツリー図など）

### 5. ドメインモデル図セクション

- Mermaid クラス図（`EnglishName["日本語名"]`形式）を使う
- 必要に応じて `note` で補足説明を追加
- 重要な関係性には適切な多重度を付与
  - 例: `Tenant "1" --> "*" Event` など

### 6. 制約条件と業務ルールセクション

- 集約内の整合性制約
  - 例: 「同一営業枠に対して確定シフトは1人のみ」など
- 値オブジェクト間の関係制約
  - 例: 「開始時刻 < 終了時刻」でなければならない など
- 業務固有のルール
  - 例: 「特別営業では特定ロールが必須」など

---

## 出力例テンプレート

```markdown
# [ドメイン名]ドメインモデル

## 概要
[ドメインの目的と責務を3〜5行で説明]

## 主要な概念

### [集約ルート名]（集約ルート）
[責務を最大3行で説明]

### [重要な値オブジェクト名]
[責務を最大3行で説明]

### [第一級コレクション名]
[責務を最大3行で説明]

## [理解が困難な概念名]（必要に応じて）
[詳細な説明]

#### 1. [具体的な種類・パターン1]
- **対象**: [適用条件]
- **特徴**: [重要な特徴]
- **例**: [具体例]

#### 2. [具体的な種類・パターン2]
- **対象**: [適用条件]
- **特徴**: [重要な特徴]
- **例**: [具体例]

## [関係性の説明タイトル]（必要に応じて）
[テナント→イベント→営業日→営業枠→シフト のような階層構造の説明など]

## ドメインモデル図

```mermaid
classDiagram
    class ShiftAggregate["シフト集約"] {
        <<aggregate root>>
        +確定する()
        +希望を集約する()
    }

    class EventAggregate["イベント集約"] {
        <<aggregate root>>
        +営業日を追加する()
    }

    class ShiftSlot["営業枠"] {
        <<entity>>
        +時間帯の検証()
    }

    class ShiftStatus["シフト状態"] {
        <<value object>>
        +状態遷移の検証()
    }

    ShiftAggregate --> ShiftSlot : 対象枠
    ShiftAggregate --> ShiftStatus : 状態
    EventAggregate --> ShiftSlot : 複数の営業枠
````

```

## 制約条件と業務ルール

### [制約グループ名]
1. **制約名**: 制約の説明
2. **制約名**: 制約の説明
```

---

## 具体的な記述例（プロジェクト文脈）

### 例: シフト状態（ShiftStatus）の詳細説明

```markdown
### シフト状態（ShiftStatus）
シフトのライフサイクル（希望受付中／仮確定／確定／キャンセル）を型安全に管理する値オブジェクト。  
状態遷移のルールをカプセル化し、不正な遷移（例: キャンセル済みから確定に戻すなど）を防止する。

#### 1. 希望受付中（Requested）
- **対象**: メンバーが営業枠に対して「入りたい」と申請した直後
- **特徴**: まだ確定されていないため、同一枠に複数存在してよい
- **例**: 同じ枠に3人が希望を出している状態

#### 2. 確定（Confirmed）
- **対象**: 運営によってその枠を担当するメンバーが決定された状態
- **特徴**: 同一枠に対しては1人のみ（または上限人数まで）
- **例**: 22:00-24:00枠にAさんが確定している状態
```

### 例: 階層構造の説明

```markdown
## テナント・イベント・営業日・営業枠の階層構造

### 階層構造の理解
- **テナント（Tenant）**: 店舗・団体の単位（例: シトロン）
- **イベント（Event）**: テナントが開催する企画単位（通常営業／特別営業など）
- **イベント営業日（EventBusinessDay）**: イベントごとの営業日単位
- **営業枠（ShiftSlot）**: 営業日の中の時間帯＋ロールの組み合わせ（例: 22:00-24:00 バーテンダー）

### 具体例
```

シトロン（テナント）
└── シトロン通常営業（イベント）
├── 2025-02-14（イベント営業日）
│   ├── 21:00-23:00 バーテンダー枠
│   └── 23:00-25:00 バーテンダー枠
└── 2025-02-21（イベント営業日）
└── 22:00-24:00 フロア枠

```
```

---

## 保存場所とファイル命名規則

### 保存場所

* ドメイン別に以下のような構成で保存すること：

  * `docs/domain/10_tenant-and-event/テナントとイベントドメインモデル.md`
  * `docs/domain/20_shift-and-slot/シフトと営業枠ドメインモデル.md`
  * `docs/domain/30_member-and-role/メンバーとロールドメインモデル.md`
  * `docs/domain/40_notification/通知ドメインモデル.md`
  * など、`*業務知識.md` / `*データモデル.md` と同じディレクトリ配下に置く。

### ファイル名

* `[ドメイン名]ドメインモデル.md`

  * 例: `シフトと営業枠ドメインモデル.md`
  * 例: `テナントとイベントドメインモデル.md`

---

## 注意事項

### 📝 記載のポイント

* **簡潔性**: 冗長な説明を避け、要点を明確にすること
* **実用性**: 実装者がすぐに `internal/domain/*` の構造を理解できる具体例を含めること
* **完全性**: 重要な制約や業務ルールは漏れなく記載すること（ただし業務知識の重複は避ける）

### 🎯 対象読者

* ドメインエキスパート（VRChatイベント運営側の知見を持つ人）
* 実装者（Go で `internal/domain/*` を実装する人）
* 保守担当者（将来、仕様変更対応を行う人）

### ⚠️ 避けるべき事項

* リポジトリ固有の実装詳細（インフラ、DBアクセス、HTTP ハンドラなど）の混入
* 全クラスの網羅的な説明（重要概念にフォーカスする）
* 純粋な業務知識の長大な再掲（`*業務知識.md` へのリンクまたは要約にとどめる）

---

## 期待する成果物

このガイドラインに従って作成されたドキュメントは、以下の特徴を持つことが期待される：

1. **理解しやすさ**

   * 主要な集約・値オブジェクト・区分オブジェクトにフォーカスした構造

2. **実用性**

   * 実装や保守に必要な情報を、Go コードとの対応関係を意識して提供している

3. **保守性**

   * 業務知識の変更に合わせて更新しやすい構造

4. **一貫性**

   * プロジェクト全体で統一されたフォーマットで記載されている

5. **完全性**

   * 重要な制約や業務ルールがドメインモデルレベルで網羅されている

ドメインモデルドキュメントを通じて、VRC Shift Scheduler チーム全体のドメイン理解を揃え、
長期的な開発・保守を支援すること。

```
