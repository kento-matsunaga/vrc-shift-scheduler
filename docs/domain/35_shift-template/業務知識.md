# 概要

本ドメインは、よく使うシフト枠の組み合わせをテンプレートとして保存し、営業日に適用する機能を定義する。テンプレートを使用することで、繰り返し同じシフト構成を簡単に再現できる。

# 主要な概念

## シフト枠テンプレート（ShiftSlotTemplate）

シフト枠テンプレートは、イベントに紐づくシフト枠の雛形である。複数のテンプレートアイテムを含む。

### 属性

| 属性 | 説明 |
|------|------|
| templateID | ULID形式の一意識別子 |
| tenantID | 所属するテナントのID |
| eventID | 関連するイベントのID |
| templateName | テンプレート名（必須、100文字以内） |
| description | 説明（オプション） |
| items | テンプレートアイテムのリスト |
| createdAt | 作成日時 |
| updatedAt | 更新日時 |
| deletedAt | 削除日時（ソフトデリート） |

### ドメインメソッド

- `UpdateDetails(templateName, description, items)`: テンプレート情報を一括更新
- `Delete()`: ソフトデリート

## シフト枠テンプレートアイテム（ShiftSlotTemplateItem）

テンプレートアイテムは、テンプレート内の1つのシフト枠定義である。

### 属性

| 属性 | 説明 |
|------|------|
| itemID | ULID形式の一意識別子 |
| templateID | 親テンプレートのID |
| positionID | 関連するポジションのID |
| slotName | 枠名（必須） |
| instanceName | インスタンス名（例: 第1インスタンス） |
| startTime | 開始時刻（TIME） |
| endTime | 終了時刻（TIME） |
| requiredCount | 必要人数（1以上） |
| priority | 優先度 |
| createdAt | 作成日時 |
| updatedAt | 更新日時 |

# テンプレート適用フロー

1. **テンプレート選択**: 適用したいテンプレートを選択
2. **営業日選択**: 適用先の営業日を選択
3. **シフト枠生成**: テンプレートアイテムをもとにシフト枠を生成
4. **確認**: 生成されたシフト枠を確認・必要に応じて調整

## 適用時の動作

- 既存のシフト枠がある営業日にもテンプレートを適用可能
- 適用により、テンプレートアイテムの数だけ新しいシフト枠が追加される
- 既存のシフト枠は削除されない（追加のみ）

# 制約条件

## 業務制約1：テナント境界

- テンプレートは必ず1つのテナントに属する
- テンプレートには同じテナント内のポジションのみ指定可能
- テンプレートには同じテナント内のイベントのみ指定可能

## 業務制約2：イベントとの関連

- テンプレートは必ず1つのイベントに属する
- 同一イベントに複数のテンプレートを作成可能
- イベント削除時、関連するテンプレートも削除される（CASCADE）

## 業務制約3：テンプレートアイテム

- 作成時はアイテムが0件でも可（後から追加）
- 更新時は1件以上のアイテムが必要
- アイテムの requiredCount は 1 以上

## 業務制約4：テンプレート名

- templateName は必須、100文字以内
- 同一イベント内でテンプレート名の重複は許可（運用で管理）

# 集約設計

## ShiftSlotTemplate集約

- ShiftSlotTemplate は集約ルート
- ShiftSlotTemplateItem は ShiftSlotTemplate 集約内のエンティティ
- アイテムはテンプレートと一緒に取得・保存される

# ユースケース

## UC1: テンプレート作成

**入力**: テナントID、イベントID、テンプレート名、説明、アイテムリスト
**出力**: 作成されたテンプレート

## UC2: テンプレート一覧取得

**入力**: イベントID
**出力**: テンプレートリスト（アイテム情報を含む）

## UC3: テンプレート詳細取得

**入力**: テンプレートID
**出力**: テンプレート（アイテム情報を含む）

## UC4: テンプレート更新

**入力**: テンプレートID、更新内容（名前、説明、アイテムリスト）
**出力**: 更新されたテンプレート

## UC5: テンプレート削除

**入力**: テンプレートID
**出力**: なし（ソフトデリート）

## UC6: テンプレート適用

**入力**: テンプレートID、営業日ID
**出力**: 作成されたシフト枠リスト

**フロー**:
1. テンプレートとアイテムを取得
2. 営業日の存在確認
3. 各アイテムからシフト枠を生成
4. 生成されたシフト枠を保存
5. 結果を返す
