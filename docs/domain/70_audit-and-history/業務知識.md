# 概要

本業務は、シフト管理における重要な操作（シフト希望の提出・修正、シフト確定の変更、設定の変更など）の履歴を残し、後から経緯を確認できるようにすることを目的とする。

VRChatイベント運営では、欠員・トラブル発生時に「誰がいつ何を操作したか」が追えないと、問題の切り分けや説明が困難になる。本業務では、重要な状態変化を監査ログとして扱う。

# 主要な概念

## 監査イベント（AuditEvent）

シフト管理における重要な操作を表すイベントである。

- 例：
  - メンバーがシフト希望を提出した
  - 運営がシフト案を修正した
  - 店長がシフトを確定状態に変更した
  - 営業枠テンプレートを変更した

## 監査対象（AuditSubject）

監査イベントの対象となる業務オブジェクトである。

- シフト希望
- シフト枠
- シフト案・確定シフト
- 営業枠テンプレート
- イベント設定

# 制約条件

## 業務制約1：重要操作の記録

- シフト希望の新規作成・修正・削除は、監査イベントとして記録する。
- シフト案から確定への状態変更、確定からキャンセルへの変更なども記録する。
- 営業枠テンプレートの変更など、シフトに大きな影響を与える設定変更も記録する。

## 業務制約2：参照範囲

- 監査ログは、テナント単位で参照される。
- 運営ロール（店長・副店長など）のみが詳細な監査情報を参照できる。

# BDD例

## 業務ルール1：シフト確定操作の監査

**シナリオ1: シフトを確定した操作を記録する**

```

Given: 2025-11-13 の営業日に対してシフト案が存在する
And: 店長ロールを持つメンバーTがログインしている
When: メンバーTが2025-11-13のシフトを「確定」状態に変更する
Then: 「2025-11-13 シフト確定」という監査イベントが記録される
And: 監査イベントには「操作日時」「操作ユーザー」「対象営業日」が含まれる

```

# PdM確認事項

## 確認項目1：監査ログの保持期間

- 監査ログをどの程度の期間保持するか（例：1年、3年）について、運営としての方針を決める必要がある。
ログは今は１年に使用初期スコープ対応で。