# 概要

本業務は、VRChat内で運営されるコンカフェ・バー・イベントにおける「シフト調整・シフト確定・関係者への共有」を、ひとつの仕組みとして一元的に管理することを目的とする。

VRChatにおけるイベント運営では、出演キャスト・スタッフの人数が多く、営業日程も通常営業と特別営業が混在するため、外部サービスやスプレッドシートを組み合わせた運用になりやすい。その結果、シフト調整の抜け漏れ、情報の分散、欠員対応の負荷が発生しやすい。

本業務知識文書は、これらの問題を解消するための「テナント（箱）」「イベント（営業単位）」「メンバー」「シフト希望」「シフト確定」「通知・リマインド」「監査」の各業務の基本ルールと関係性を定義する。

# 主要な概念

## テナント（Tenant）

VRChat内で活動するひとつの団体・店舗・イベント運営チームを指す。通常は1つのコミュニティ単位（例：1つのDiscordサーバ）に対応し、以下を束ねる。
- 複数のイベント（通常営業・特別営業）
- 所属メンバー（キャスト・店長・スタッフ）
- シフトに関する全ての設定と履歴

## イベント（Event）

テナントが運営する営業・イベントの単位である。週次で繰り返される通常営業と、特定日程のみの特別営業を含む。
- 通常営業：例として毎週木曜日21:30〜23:00のような反復パターンを持つ営業
- 特別営業：Vket期間の臨時営業や撮影会など、任意の日付・時間帯で設定される営業

## メンバー（Member）

テナントに所属し、シフトの対象となる人物を指す。VRChatアカウント・名称と、連絡に用いる外部アカウント（例：チャットツール上のID）とが紐づく。
- キャスト：お客さまと接客する側
- 店長・副店長：最終的なシフト確定と運営判断を行う
- スタッフ：受付・場内案内・撮影補助などを行う

## ポジション（Position）

営業時に必要となる役割を表す。「IL（インスタンスリーダー）」「カウンター」「テーブル」「受付」「カメラ」など、イベントごとに定義される役割の種別である。ポジションごとに同時に必要な人数が決まる。

## シフト枠（Shift Slot）

特定のイベント営業日の、時間帯・インスタンス・ポジションを組み合わせた「1人分の席」である。
- 例：2025-11-13 21:30〜23:00 / 第一インスタンス / カウンターA の1枠
- 同じ時間帯に複数インスタンスや複数のポジション枠が存在しうる

## シフト希望（Availability）

メンバーが「出勤可能な日・時間帯・ポジションの希望」を申告した情報である。
- 参加可能時間帯
- 希望ポジション（第1〜第n希望）
- 希望の強さ・優先度
を含む。

## シフト確定（Shift Plan）

運営がシフト希望を反映しつつ、営業に必要な人数やバランスを考慮して作成する「最終的な配置計画」である。
- 各シフト枠に対して「誰が入るか」を確定させる
- 仮確定→確定といった状態の遷移を持つ

## 通知・リマインド（Notification）

テナント内のメンバーに対し、シフトに関する情報を伝える行為である。
- シフト募集開始の告知
- シフト確定結果の共有
- 出勤前リマインド
- 欠員発生時の補欠募集・緊急ヘルプ要請

## 監査・履歴（Audit Log）

シフト希望・シフト確定・設定変更など、重要な業務操作の履歴を残すための概念である。
- いつ・誰が・どの営業・どの枠に対して何を変更したか
- 後からトラブル発生時に経緯を追えるようにする

# 制約条件

## 業務制約1：テナント境界

- シフトに関する設定・希望・確定情報は、必ずひとつのテナントに属する。
- あるテナントの情報を別テナントから参照・変更することはできない。

## 業務制約2：イベントと営業日の関係

- イベントは「通常営業パターン」と「特別営業日」の両方を持てる。
- 営業日は必ずいずれかのイベントに所属する。
- 同一テナント内で、同一日時・同一イベントに対して重複した営業定義を持つことはできない。

## 業務制約3：メンバーとロール

- 各メンバーはテナント単位でロール（店長・副店長・キャスト・スタッフ）を持つ。
- シフト確定権限を持つのは、店長・副店長ロールを付与されたメンバーに限定される。

## 業務制約4：シフト枠の充足性

- 各営業日の各ポジションには「必要人数」が定義される。
- シフト確定時点で、必要人数を下回っている枠は「不足」として認識される。
- 必要人数を超えて配置された枠は「過剰配置」として認識される。

## 業務制約5：希望と確定の整合性

- シフト確定は、原則としてメンバーが提出したシフト希望の範囲内で行う。
- 希望外での配置を行う場合は、明示的な合意が前提となる（運営内ルール）。

# BDD例

## 業務ルール1：テナントごとのシフト管理の分離

**シナリオ1: 異なるテナント間の情報は混ざらない**

```

Given: テナントAとテナントBが存在する
And: メンバーXはテナントAにのみ所属している
And: テナントAでイベント「シトロン通常営業」が登録されている
When: メンバーXのシフト希望と確定シフトを参照する
Then: テナントAのイベントに関する情報のみが参照される
And: テナントBのイベント情報は参照できない

```

## 業務ルール2：通常営業と特別営業の共存

**シナリオ1: 通常営業パターンに加えて特別営業日を追加する**

```

Given: イベント「シトロン通常営業」が存在する
And: 通常営業パターンとして「毎週木曜21:30〜23:00」が登録されている
And: Vket期間の特別営業日として「2025-11-11 21:30〜23:00」を追加したい
When: イベントに特別営業日として2025-11-11を登録する
Then: 通常営業パターンは変更されない
And: 2025-11-11のみ特別営業として個別の日付群に含まれる

```

# PdM確認事項

## 確認項目1：テナントの粒度

- テナントは「Discordサーバ単位」とみなすか、「1イベント運営チーム単位」とみなすかを明確にしたい。
    PDM回答：テナントは１イベント１単位とします。
- 同一Discordサーバ内で複数の箱・イベントブランドを運営するケースをどう扱うか要確認。
    PDM回答：今は１イベント1ディスコードとする。

## 確認項目2：希望外配置の扱い

- メンバーの希望外の配置（急なヘルプなど）をシステム上でどう表現するか（「同意済み希望外枠」など）について運営方針の確認が必要。
    PDM回答：ヘルプはヘルプ募集ぐらいでロールなどには影響を与えないとする。
