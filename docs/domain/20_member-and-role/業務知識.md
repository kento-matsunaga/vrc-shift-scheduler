# 概要

本ドメインは、テナントに所属するメンバー（スタッフ）とロール（属性タグ）の管理を定義する。メンバーはシフトに配置される対象であり、ロールはメンバーに付与される分類・属性情報である。

**注意**: 権限制御（店長/副店長の区別）は Admin の role（owner/manager）で管理される。本ドメインの Role は分類・フィルタリングのための属性タグである。

# 主要な概念

## メンバー（Member）

メンバーは、テナントに所属し、シフトの対象となる人物である。VRChatでの表示名やDiscord IDで識別される。

### 属性

| 属性 | 説明 |
|------|------|
| memberID | ULID形式の一意識別子 |
| tenantID | 所属するテナントのID |
| displayName | 表示名（必須、255文字以内） |
| discordUserID | Discord ユーザーID（オプション、100文字以内） |
| email | メールアドレス（オプション、255文字以内） |
| isActive | アクティブ状態 |
| createdAt | 作成日時 |
| updatedAt | 更新日時 |
| deletedAt | 削除日時（ソフトデリート） |

### ドメインメソッド

- `UpdateDetails(displayName, discordUserID, email, isActive)`: メンバー情報を一括更新
- `UpdateDisplayName(name)`: 表示名を更新
- `UpdateDiscordUserID(id)`: Discord IDを更新
- `UpdateEmail(email)`: メールアドレスを更新
- `Activate()`: メンバーを有効化
- `Deactivate()`: メンバーを無効化
- `Delete()`: ソフトデリート

## ロール（Role）

ロールは、メンバーに付与される役割・属性を表す。権限制御ではなく、分類やフィルタリングのための属性タグとして機能する。

### 属性

| 属性 | 説明 |
|------|------|
| roleID | ULID形式の一意識別子 |
| tenantID | 所属するテナントのID |
| name | ロール名（必須、100文字以内） |
| description | 説明（オプション、500文字以内） |
| color | UI表示用の色コード（例: #FF5733、20文字以内） |
| displayOrder | 表示順序 |
| createdAt | 作成日時 |
| updatedAt | 更新日時 |
| deletedAt | 削除日時（ソフトデリート） |

### ロールの用途例

- 「ベテラン」「新人」：経験レベルの分類
- 「カウンター担当」「フロア担当」：スキルや担当領域
- 「IL可能」：特定条件での参加可否
- 「幹部」「レギュラー」：組織内での立場

### ドメインメソッド

- `UpdateDetails(name, description, color, displayOrder)`: ロール情報を一括更新
- `Delete()`: ソフトデリート

## メンバーロール関連（MemberRole）

メンバーとロールは多対多の関係であり、中間テーブルで管理される。

### 構造

| 属性 | 説明 |
|------|------|
| memberID | メンバーID |
| roleID | ロールID |

### 特徴

- 1人のメンバーに複数のロールを割り当て可能
- 1つのロールを複数のメンバーに割り当て可能
- 複合主キー（memberID, roleID）

# 制約条件

## 業務制約1：テナント境界

- メンバーは必ず1つのテナントに属する
- ロールは必ず1つのテナントに属する
- メンバーには同じテナント内のロールのみ割り当て可能

## 業務制約2：メンバーの識別

- displayName はテナント内で一意である必要はない（同名メンバー可）
- discordUserID は一意性の制約なし（同一Discordユーザーが複数テナントに所属可能）

## 業務制約3：ロールの特性

- ロールは権限制御には使用しない（権限は Admin の role で管理）
- ロールは分類・フィルタリング・UI表示のために使用
- 同一テナント内でロール名の重複は許可（運用で管理）

## 業務制約4：削除時の扱い

- メンバー削除時、関連する MemberRole は物理削除
- ロール削除時、関連する MemberRole は物理削除
- シフト割り当て履歴は保持される

## 業務制約5：アクティブ状態

- isActive = false のメンバーはシフト対象から除外される
- 非アクティブメンバーの過去履歴は保持される

# 集約設計

## Member集約

- Member は集約ルート
- MemberRole は Member に紐づくが、Repository で別途管理

## Role集約

- Role は独立した集約ルート

# ユースケース

## UC1: メンバー作成

**入力**: テナントID、表示名、Discord ID（オプション）、メールアドレス（オプション）
**出力**: 作成されたメンバー

## UC2: メンバー一覧取得

**入力**: テナントID、フィルター条件（アクティブ状態、ロール）
**出力**: メンバーリスト（ロール情報を含む）

## UC3: メンバー情報更新

**入力**: メンバーID、更新内容
**出力**: 更新されたメンバー

## UC4: ロール作成

**入力**: テナントID、ロール名、色、説明
**出力**: 作成されたロール

## UC5: ロール一覧取得

**入力**: テナントID
**出力**: ロールリスト（表示順序でソート）

## UC6: メンバーへのロール割り当て

**入力**: メンバーID、ロールIDリスト
**出力**: 更新されたメンバー（ロール情報を含む）

## UC7: ロールによるメンバーフィルタリング

**入力**: テナントID、ロールIDリスト
**出力**: 指定ロールを持つメンバーリスト（OR条件：いずれかのロールを持つメンバー）
