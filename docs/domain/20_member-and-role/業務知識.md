# 概要

本業務は、テナントに所属するメンバー（キャスト・店長・スタッフなど）の属性とロール、およびシフト管理上必要となる識別情報のルールを定義する。

VRChatでは、アバター名・表示名と実際の連絡手段（チャットツールのアカウントなど）が異なる場合が多く、シフト管理の対象である人物を一意に把握し続ける必要がある。また、シフト確定権限を持つ運営側と、シフト希望を提出するキャスト側の役割分担も明確にしておく必要がある。

# 主要な概念

## メンバー（Member）

テナントに所属する人物を表す。以下の属性を持つ。

- 表示名（キャスト名）
- VRChatアカウント識別用情報（例：VRChat内のユーザー名）
- 連絡用アカウント情報（例：チャットツールのユーザーID）
- 有効／一時停止などの状態

## ロール（Role）

メンバーに付与される役割区分である。テナント単位で付与される。

- 店長：最終的なシフト確定権限と運営方針決定権を持つ
- 副店長：店長を補佐し、シフト確定や運営判断を代行できる
- キャスト：接客を担当する
- スタッフ：受付・案内・撮影補助などサポート業務を担当する

## メンバー状態（MemberStatus）

メンバーがシフト対象として扱われるかどうかの状態を表す。

- 在籍中：通常どおりシフト希望と配置の対象となる
- 休止中：一時的にシフト対象から外す
- 退店：過去の実績は保持するが、新規のシフト対象にはならない

# 制約条件

## 業務制約1：メンバー識別

- シフト管理で扱うメンバーは、テナント内で一意に識別できなければならない。
- 表示名が変わっても、同一人物として扱えるように識別子を保持する必要がある。

## 業務制約2：ロールの組み合わせ

- 一人のメンバーが複数のロールを持つことは許可される（例：キャスト兼スタッフ）。
- ただし、店長・副店長ロールは人数が限定される運営方針が多いため、テナントごとに上限人数を運用で決める。

## 業務制約3：シフト確定権限

- シフト確定操作を行えるのは、店長ロールまたは副店長ロールを持つメンバーに限定される。
- キャストや一般スタッフは、自分のシフト希望の提出と、自身の確定シフトの確認のみを行う。

## 計算制約

- メンバーの識別子は、表示名が変更されても一貫して同一人物を追跡できる形で管理される。
- ロールの組み合わせによる権限は、最も強い権限が適用される（例：キャスト兼副店長の場合、副店長としての権限を持つ）。

## 法律制約

- 現時点では特になし。
- メンバー情報の取り扱いはテナント運営方針に従う。

# BDD例

## 業務ルール1：メンバー識別の一貫性

**シナリオ1: キャスト名が変更されても同一人物として扱う**

```

Given: テナント「シトロン」にメンバーAが在籍している
And: メンバーAの内部識別子とVRChatアカウントIDが登録されている
And: メンバーAの表示名が「らっと」から「らっと改」に変更された
When: メンバーAの過去のシフト履歴を参照する
Then: 旧表示名「らっと」の時期のシフト履歴も含めて、
すべてメンバーAの履歴として一続きで参照できる

```

## 業務ルール2：シフト確定権限の制限

**シナリオ1: キャストが他人のシフトを確定できない**

```

Given: テナント「シトロン」に店長ロールのメンバーTと
キャストロールのみのメンバーCが在籍している
And: 2025-11-13 の営業日に対してシフト草案が作成されている
When: メンバーCが営業日のシフト確定操作を試みる
Then: シフト確定は行われない
And: シフト確定は店長ロールを持つメンバーTによってのみ行われる

```

## 業務ルール3：休止中メンバーのシフト対象外（異常系）

**シナリオ1: 休止中のメンバーはシフト希望提出の対象にならない**

```

Given: テナント「シトロン」にメンバーAが在籍している
And: メンバーAの状態が「休止中」に設定されている
And: 2025-12月の希望期間が設定されている
When: シフト希望提出の対象者一覧を取得する
Then: メンバーAは対象者一覧に含まれない
And: 在籍中のメンバーのみが対象者として表示される

```

## 業務ルール4：複数ロール保持時の権限（境界値）

**シナリオ1: キャスト兼副店長はシフト確定権限を持つ**

```

Given: テナント「シトロン」にメンバーMが在籍している
And: メンバーMは「キャスト」と「副店長」の両方のロールを持っている
And: 2025-11-13 の営業日に対してシフト草案が作成されている
When: メンバーMがシフト確定操作を行う
Then: シフト確定が正常に実行される
And: メンバーMは副店長ロールの権限により確定操作が許可される

```

# PdM確認事項

## 確認項目1：匿名性と表記ゆれの扱い

- 公開されるシフト表に表示する名前と、運営側だけが把握する内部識別情報の分離レベルをどこまで行うか確認が必要。
PDM回答：基本的にVRC上での名前がわかればよし
- キャストの安全性・匿名性をどこまで考慮するかによって設計が変わる可能性がある。
PDM回答：名前は申告制で運営がこのシステムに設定する。