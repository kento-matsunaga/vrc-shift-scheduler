# 概要

本業務は、イベントの各営業日において必要となる「インスタンス」「ポジション」「人数」を構造化し、シフトを割り当てるための枠（シフト枠）を定義することを目的とする。

シトロンヴェールの例では、「第一インスタンス」「第二インスタンス」ごとに、カウンターA〜D・テーブルE〜Hといったポジションが存在し、それぞれに必要人数が決まっている。この情報をもとに、どの時間帯にどのポジションが何枠存在するかを管理する。

# 主要な概念

## 営業枠テンプレート（ShiftTemplate）

イベントごとに定義される、営業時のインスタンス構成とポジション構成のテンプレートである。

- 例：九龍想定
  - A〜D: カウンター
  - E〜H: テーブル
- 各ポジションの名称と役割の説明、必要人数のデフォルト設定を含む。

## 営業日インスタンス（EventInstance）

特定の営業日における、インスタンス単位（第一インスタンス、第二インスタンスなど）の営業単位である。

- 営業日 × インスタンス で一意に決まる。

## シフト枠（ShiftSlot）

営業日インスタンスとポジションの組み合わせで定義される「1人分の席」である。

- 属性例：
  - 営業日
  - インスタンス（第一／第二）
  - ポジション（カウンターAなど）
  - 枠番号（ポジション内で複数枠を持つ場合）

# 制約条件

## 業務制約1：テンプレートと営業日の関係

- 営業枠テンプレートはイベント単位で定義される。
- 実際の営業日には、テンプレートを元にシフト枠が展開される。
- 個別の営業日でテンプレートからの微調整（特定ポジションを増減）を行う場合がある。

## 業務制約2：ポジションの識別

- 各ポジションはイベント内で一意に識別できる名前を持つ（例：A, B, C, D）。
- 同一ポジション名をインスタンスごとに繰り返し使用することは許可されるが、
  営業日＋インスタンス＋ポジション名の組み合わせは一意である。

## 計算制約

- シフト枠の総数は「インスタンス数 × ポジション数」で算出される。
- テンプレートからシフト枠を生成する際、各ポジションの必要人数に応じて枠番号が付与される。

## 法律制約

- 現時点では特になし。

# BDD例

## 業務ルール1：テンプレートから営業日のシフト枠を生成する

**シナリオ1: 九龍想定テンプレートから第一・第二インスタンスの枠を生成**

```

Given: イベント「シトロンヴェール」に
営業枠テンプレート「九龍想定」が定義されている
And: テンプレートには A〜D がカウンター、E〜H がテーブルとして登録されている
And: 2025-11-13 の営業日が「通常営業」として登録されている
When: 2025-11-13 の営業日に対して、
第一インスタンスと第二インスタンスのシフト枠を生成する
Then: 第一インスタンス用に A〜H のシフト枠が作成される
And: 第二インスタンス用にも A〜H のシフト枠が作成される

```

## 業務ルール2：重複するシフト枠の定義（異常系）

**シナリオ1: 同一営業日・インスタンス・ポジションの枠を二重生成できない**

```

Given: 2025-11-13 の営業日に対して
第一インスタンスのカウンターAのシフト枠が既に生成されている
When: 同じ営業日・第一インスタンス・カウンターAの
シフト枠を再度生成しようとする
Then: 新規の枠は作成されない
And: 既存の枠がそのまま維持される

```

## 業務ルール3：テンプレート未定義時のシフト枠生成（境界値）

**シナリオ1: テンプレートが空の場合はシフト枠が生成されない**

```

Given: イベント「新規イベント」に営業枠テンプレートが定義されていない
And: 2025-12-01 の営業日が登録されている
When: 2025-12-01 の営業日に対してシフト枠を生成しようとする
Then: シフト枠は0件生成される
And: テンプレート未定義のため生成対象がない旨が通知される

```

# PdM確認事項

## 確認項目1：テンプレートの柔軟性

- イベントごとにポジション構成が大きく変わる場合、
  - どこまで共通テンプレート化するか
  - どこから個別営業日の上書きとして扱うか
  を確認する必要がある。
PDM回答：属性を選択制にしたい。各人に属性を付与して、優先度順をつけてあげればシステム的にはできると思う
