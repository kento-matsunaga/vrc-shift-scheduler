# 概要

本ドメインは、営業日において必要となる「シフト枠（ShiftSlot）」と「ポジション（Position）」を定義することを目的とする。シフト枠はメンバーを配置する「席」であり、ポジションは役職・役割の種別である。

# 主要な概念

## ポジション（Position）

ポジションは、営業時に必要となる役割の種別である。シフト枠を作成する際のカテゴリとして使用される。

### 属性

| 属性 | 説明 |
|------|------|
| positionID | ULID形式の一意識別子 |
| tenantID | 所属するテナントのID |
| positionName | ポジション名（必須、255文字以内） |
| description | 説明（オプション） |
| displayOrder | 表示順序 |
| isActive | アクティブ状態 |
| createdAt | 作成日時 |
| updatedAt | 更新日時 |
| deletedAt | 削除日時（ソフトデリート） |

### ポジションの用途例

- 「受付」：来場者の受付担当
- 「案内」：場内の案内担当
- 「配信」：配信オペレーション担当
- 「MC」：司会進行担当
- 「カウンター」：カウンター席担当
- 「テーブル」：テーブル席担当

### ドメインメソッド

- `UpdatePositionName(name)`: ポジション名を更新
- `UpdateDescription(desc)`: 説明を更新
- `UpdateDisplayOrder(order)`: 表示順序を更新
- `Activate()`: ポジションを有効化
- `Deactivate()`: ポジションを無効化
- `Delete()`: ソフトデリート

## シフト枠（ShiftSlot）

シフト枠は、特定の営業日における、時間帯・ポジションを組み合わせた「複数人分の席」である。

### 属性

| 属性 | 説明 |
|------|------|
| slotID | ULID形式の一意識別子 |
| tenantID | 所属するテナントのID |
| businessDayID | 関連する営業日のID |
| positionID | 関連するポジションのID |
| slotName | 枠名（必須、255文字以内） |
| instanceName | インスタンス名（例: 第1インスタンス） |
| startTime | 開始時刻（TIME） |
| endTime | 終了時刻（TIME） |
| requiredCount | 必要人数（1以上） |
| priority | 優先度（割り当て順序の参考） |
| createdAt | 作成日時 |
| updatedAt | 更新日時 |
| deletedAt | 削除日時（ソフトデリート） |

### 深夜営業対応

- 終了時刻が開始時刻より前の場合、日付をまたぐシフトとして扱う
- `IsOvernight()`: 深夜営業かどうかを判定

### ドメインメソッド

- `UpdateSlotName(name)`: 枠名を更新
- `UpdateRequiredCount(count)`: 必要人数を更新
- `UpdatePriority(priority)`: 優先度を更新
- `Delete()`: ソフトデリート
- `StartTimeString()`: 開始時刻を HH:MM 形式で返す
- `EndTimeString()`: 終了時刻を HH:MM 形式で返す

# 制約条件

## 業務制約1：テナント境界

- ポジションは必ず1つのテナントに属する
- シフト枠は必ず1つのテナントに属する
- シフト枠には同じテナント内のポジションのみ指定可能

## 業務制約2：営業日との関連

- シフト枠は必ず1つの営業日に属する
- 営業日が削除されると、関連するシフト枠も削除される（CASCADE）

## 業務制約3：必要人数

- requiredCount は 1 以上でなければならない
- 0人のシフト枠は作成できない

## 業務制約4：時間帯の整合性

- startTime と endTime は必須
- 深夜営業（終了時刻 < 開始時刻）をサポート

## 業務制約5：ポジションの削除

- ポジション削除時、関連するシフト枠のポジション参照は維持される
- 削除されたポジションを新規シフト枠に指定することはできない

# 集約設計

## Position集約

- Position は独立した集約ルート

## ShiftSlot

- ShiftSlot は独立したエンティティ
- EventBusinessDay に紐づくが、EventBusinessDay 集約には含まれない

# ユースケース

## UC1: ポジション作成

**入力**: テナントID、ポジション名、説明、表示順序
**出力**: 作成されたポジション

## UC2: ポジション一覧取得

**入力**: テナントID
**出力**: ポジションリスト（表示順序でソート）

## UC3: シフト枠作成

**入力**: テナントID、営業日ID、ポジションID、枠名、時間帯、必要人数
**出力**: 作成されたシフト枠

## UC4: シフト枠一覧取得

**入力**: 営業日ID
**出力**: シフト枠リスト（優先度・開始時刻でソート）

## UC5: シフト枠更新

**入力**: シフト枠ID、更新内容
**出力**: 更新されたシフト枠

## UC6: シフト枠削除

**入力**: シフト枠ID
**出力**: なし（ソフトデリート）
