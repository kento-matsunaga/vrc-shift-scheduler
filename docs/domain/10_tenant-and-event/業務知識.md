# 概要

本業務は、VRChatコンカフェ・イベントにおける「テナント（箱）」「イベント」「通常営業」「特別営業」「営業日」の関係を定義し、シフト管理の前提となる営業スケジュールの土台を作ることを目的とする。

ここでは「シトロンヴェール」を典型例とし、週1回の通常営業（毎週木曜日21:30〜23:00）と、Vketなどの期間に応じた不定期の特別営業を同一イベントの中で扱えるようにする。

# 主要な概念

## テナント

テナントは、ひとつのコンカフェ・イベント運営チームを表す単位である。  
属性としては、名称、説明、活動ワールド、連絡用のコミュニティ空間などを持つ。

## イベント

イベントは、テナントが継続的に行う営業ブランド・企画の単位である。

- 例：「シトロンヴェール」
- 同一テナント内で複数イベントを持つことができる（レギュラー営業と別企画など）

イベントは、以下の二種類の営業を束ねる。

### 通常営業パターン（Recurring Pattern）

- 曜日・時間帯が反復する営業の定義である。
- 例：毎週木曜 21:30〜23:00
- 各パターンは「開始曜日」「開始時刻」「終了時刻」「繰り返しルール（週次）」を持つ。

### 特別営業日（Special Occurrence）

- 特定の日付・時間帯で行う単発または期間限定の営業である。
- 例：2025-11-11 21:30〜23:00（Vketラウンジ営業）
- 同一イベント内で通常営業パターンと並行して存在する。

## 営業日（Event Occurrence）

- 実際にシフトを組む対象となる「1回分の営業日」である。
- 通常営業パターンから自動生成される日付と、特別営業日として明示的に登録された日付の両方を含む。
- 営業日は「日付」「開始時刻」「終了時刻」「種別（通常／特別）」を持つ。

# 制約条件

## 業務制約1：イベントとテナントの関係

- イベントは必ず1つのテナントに属する。
- 同名のイベントを別テナントで持つことは可能だが、同一テナント内ではイベント名称は一意である。

## 業務制約2：通常営業パターンの定義

- 通常営業パターンは「曜日＋時刻＋繰り返しルール」で定義される。
- 同一イベント内で、曜日と時間帯が完全に重複する通常営業パターンを二重に定義してはならない。
- 通常営業パターンに基づき、自動的に営業候補日が生成される。

## 業務制約3：特別営業日の定義

- 特別営業日は、具体的な日付と時間帯を指定して登録される。
- 通常営業パターンと同じ日付・時間帯に特別営業日を定義する場合、その営業日は「どちらとして扱うか」を決めるルールが必要になる（上書き／別枠など）。

## 業務制約4：営業日の有効期間

- 営業日として扱う期間（例：1ヶ月先まで、3ヶ月先までなど）はテナントごとに運用ルールを決める。
- シフト募集や確定を行える営業日は、事前に「有効な営業日」として生成されている必要がある。

# BDD例

## 業務ルール1：通常営業パターンから営業日を生成する

**シナリオ1: シトロンヴェールの12月通常営業日を生成する**

```

Given: テナント「シトロン」が存在する
And: テナント「シトロン」にイベント「シトロンヴェール」が登録されている
And: イベント「シトロンヴェール」に通常営業パターン
「毎週木曜 21:30〜23:00」が設定されている
And: 営業日生成対象期間が「2025-12-01〜2025-12-31」に設定されている
When: 2025-12月分の営業日生成処理を行う
Then: 2025-12月中の全ての木曜日について
21:30〜23:00の営業日が「通常営業」として登録される

```

**シナリオ2: 期間外の日付は生成されない**

```

Given: 上記と同じ通常営業パターンが存在する
And: 営業日生成対象期間が「2025-12-01〜2025-12-31」に設定されている
When: 営業日生成処理を行う
Then: 2025-11月および2026-01月の木曜日については
営業日は生成されない

```

## 業務ルール2：特別営業日の追加

**シナリオ1: Vket期間の特別営業を追加する**

```

Given: イベント「シトロンヴェール」に通常営業パターン
「毎週木曜 21:30〜23:00」が設定されている
And: 営業日生成対象期間「2025-11-01〜2025-11-30」に対して
通常営業日日が既に生成されている
When: 2025-11-11 21:30〜23:00 を特別営業日として追加登録する
Then: 2025-11-11 21:30〜23:00 の営業日が
「特別営業」として追加される
And: 木曜日の通常営業日は変更されない

```

# PdM確認事項

## 確認項目1：通常営業と特別営業の優先度

- 通常営業パターンと同じ日程・時間帯で特別営業を定義した場合、
  - 通常営業を上書きするのか
  - 別のイベントとして扱うのか
  - 同じイベント内で「種別」だけ切り替えるのか
  の方針を決める必要がある。

## 確認項目2：営業日生成の運用単位

- 営業日を自動生成する対象期間を
  - 毎月更新するのか
  - 3ヶ月単位で更新するのか
  など、現実の運営フローに合わせて決める必要がある。
