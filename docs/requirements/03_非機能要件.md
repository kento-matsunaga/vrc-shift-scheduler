# 非機能要件

## 1. 性能要件

### 1.1 レスポンス時間

| 操作 | 目標値 | 備考 |
|------|--------|------|
| API レスポンス（一覧取得） | 500ms以内 | 100件程度のデータ |
| API レスポンス（単一取得） | 200ms以内 | |
| API レスポンス（作成/更新） | 300ms以内 | |
| ページ初期表示 | 2秒以内 | |

### 1.2 同時接続数

| 項目 | 目標値 | 備考 |
|------|--------|------|
| 同時接続ユーザー数 | 50人以上 | 小〜中規模のイベント運営を想定 |
| API 同時リクエスト | 100 req/s | |

### 1.3 データ量

| 項目 | 想定値 | 備考 |
|------|--------|------|
| テナントあたりのメンバー数 | 〜100人 | |
| テナントあたりのイベント数 | 〜20個 | |
| 月あたりの営業日数 | 〜100日 | 複数イベント合計 |
| 営業日あたりのシフト枠数 | 〜30枠 | |

## 2. 可用性要件

### 2.1 稼働率

| 項目 | 目標値 | 備考 |
|------|--------|------|
| システム稼働率 | 99%以上 | 月間約7時間のダウンタイム許容 |
| 計画停止 | 事前通知 | 最低24時間前に通知 |

### 2.2 バックアップ

| 項目 | 方針 |
|------|------|
| データベースバックアップ | 日次 |
| バックアップ保持期間 | 7日間 |
| リストア目標時間 | 4時間以内 |

## 3. セキュリティ要件

### 3.1 認証・認可（目標）

| 項目 | 方針 | 現状 |
|------|------|------|
| 認証方式 | Discord OAuth 2.0 | ❌ localStorage ベースの簡易実装 |
| セッション管理 | JWT / セッションCookie | ❌ 未実装 |
| RBAC | ロールベースアクセス制御 | ❌ 未実装 |
| テナント分離 | テナントIDによる完全分離 | ⚠️ DBレベルのみ |

### 3.2 データ保護

| 項目 | 方針 |
|------|------|
| 通信暗号化 | HTTPS（本番環境） |
| パスワード | 外部認証（Discord OAuth）に委譲 |
| 個人情報 | 最小限の取得（表示名、Discord ID、メール） |

### 3.3 API セキュリティ

| 項目 | 方針 | 現状 |
|------|------|------|
| CORS | 許可オリジン制限 | ✅ 実装済み |
| レートリミット | API呼び出し制限 | ❌ 未実装 |
| 入力検証 | サーバーサイドバリデーション | ✅ 実装済み |

## 4. 運用・保守要件

### 4.1 ログ管理

| 項目 | 方針 | 現状 |
|------|------|------|
| アクセスログ | HTTPリクエストログ | ✅ ミドルウェアで実装 |
| エラーログ | エラー詳細とスタックトレース | ✅ 基本実装 |
| 監査ログ | 重要操作の記録 | ❌ テーブルのみ |
| ログ保持期間 | 30日間 | - |

### 4.2 監視

| 項目 | 方針 | 現状 |
|------|------|------|
| ヘルスチェック | `/health` エンドポイント | ✅ 実装済み |
| メトリクス収集 | Prometheus形式 | ❌ 未実装 |
| アラート | エラー率・レスポンス時間 | ❌ 未実装 |

### 4.3 デプロイ

| 項目 | 方針 |
|------|------|
| デプロイ方式 | Docker コンテナ |
| 環境 | 開発 / 本番 |
| マイグレーション | 自動実行（up）|
| ロールバック | マイグレーションdown対応 |

## 5. 互換性要件

### 5.1 ブラウザ対応

| ブラウザ | 対応バージョン |
|----------|---------------|
| Chrome | 最新2バージョン |
| Firefox | 最新2バージョン |
| Safari | 最新2バージョン |
| Edge | 最新2バージョン |

### 5.2 API バージョニング

| 項目 | 方針 |
|------|------|
| バージョン管理 | URLパス（`/api/v1/`） |
| 後方互換性 | メジャーバージョン内で維持 |
| 廃止通知 | 最低3ヶ月前 |

## 6. スケーラビリティ要件

### 6.1 水平スケーリング

| 項目 | 対応状況 |
|------|---------|
| アプリケーションサーバー | ステートレス設計 |
| データベース | 単一インスタンス（MVP） |
| ロードバランサー | 未対応（MVP） |

### 6.2 将来の拡張

| 項目 | 方針 |
|------|------|
| マルチリージョン | 将来対応予定 |
| キャッシュ | Redis 導入予定 |
| 非同期処理 | メッセージキュー導入予定 |

## 7. 開発・テスト要件

### 7.1 コード品質

| 項目 | 基準 |
|------|------|
| テストカバレッジ | 70%以上（目標） |
| Lint | golangci-lint / ESLint |
| フォーマット | gofmt / Prettier |

### 7.2 テスト種別

| 種別 | 対象 | 現状 |
|------|------|------|
| ユニットテスト | ドメインモデル | ⚠️ 一部実装 |
| 統合テスト | リポジトリ、API | ⚠️ 一部実装 |
| E2Eテスト | 画面操作 | ❌ 未実装 |

### 7.3 開発環境

| 項目 | ツール |
|------|--------|
| コンテナ | Docker Compose |
| ホットリロード | Air（Go）/ Vite（React） |
| DB GUI | pgAdmin / DBeaver |




