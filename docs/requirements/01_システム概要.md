# システム概要

## 1. プロジェクトの目的

VRC Shift Scheduler は、VRChat内で運営されるコンカフェ・バー・イベントにおける「シフト調整・シフト確定・関係者への共有」を一元管理するシステムである。

### 1.1 解決する課題

VRChatにおけるイベント運営では、以下の課題が発生しやすい：

- 出演キャスト・スタッフの人数が多く、シフト調整が煩雑
- 通常営業と特別営業が混在し、情報が分散
- 外部サービスやスプレッドシートを組み合わせた運用による抜け漏れ
- 欠員発生時の対応負荷が高い

本システムは、これらの問題を解消し、運営業務の効率化を実現する。

### 1.2 対象ユーザー

| ユーザー種別 | 説明 |
|-------------|------|
| 店長/副店長 | イベントの最終的なシフト確定と運営判断を行う |
| キャスト | 接客を行い、シフト希望を提出する |
| スタッフ | 受付・場内案内・撮影補助などを行う |

## 2. システムスコープ

### 2.1 対象範囲

```
┌─────────────────────────────────────────────────────────────┐
│                    VRC Shift Scheduler                       │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ イベント管理  │  │  メンバー管理  │  │   シフト管理   │       │
│  │              │  │              │  │              │       │
│  │ - 通常営業   │  │ - 登録・更新  │  │ - 枠定義     │       │
│  │ - 特別営業   │  │ - 表示名管理  │  │ - 割り当て   │       │
│  │ - 営業日生成 │  │              │  │ - 一覧表示   │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ 希望提出     │  │  通知        │  │   監査ログ    │       │
│  │ (MVP未実装)  │  │ (MVP未実装)  │  │ (MVP未実装)   │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 MVP（現在の実装）で実現する機能

1. **イベント管理**
   - イベントの作成・一覧表示
   - 通常営業/特別営業の区分

2. **営業日管理**
   - イベント配下の営業日作成・一覧表示
   - 日付・開始時刻・終了時刻の設定
   - 深夜営業対応（日付をまたぐ営業）

3. **シフト枠管理**
   - 営業日配下のシフト枠作成・一覧表示
   - 必要人数・優先度の設定

4. **シフト割り当て**
   - メンバーへのシフト手動割り当て
   - 割り当て状況の確認

5. **メンバー管理**
   - メンバーの登録・一覧表示
   - 簡易ログイン機能

### 2.3 将来対応予定の機能

1. **シフト希望収集**
   - メンバーによる希望提出
   - 希望ポジション・優先度の指定

2. **通知機能**
   - シフト募集開始の告知
   - シフト確定結果の共有
   - 出勤前リマインド
   - Discord連携

3. **監査機能**
   - 操作履歴の自動記録
   - 変更追跡

4. **テナント管理**
   - マルチテナント対応
   - テナント単位での完全なデータ分離

5. **権限管理**
   - ロールベースアクセス制御
   - 店長/副店長/キャスト/スタッフの権限分離

## 3. 技術スタック

### 3.1 バックエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| Go | 1.23+ | アプリケーションサーバー |
| go-chi/chi | v5 | HTTPルーター |
| pgx | v5 | PostgreSQLドライバー |
| PostgreSQL | 16 | データベース |

### 3.2 フロントエンド

| 技術 | バージョン | 用途 |
|------|-----------|------|
| React | 19 | UIフレームワーク |
| TypeScript | - | 型安全な開発 |
| Vite | 7 | ビルドツール |
| Tailwind CSS | 4 | スタイリング |
| React Router | - | ルーティング |

### 3.3 インフラ

| 技術 | 用途 |
|------|------|
| Docker | 開発環境のコンテナ化 |
| Docker Compose | マルチコンテナ管理 |

## 4. アーキテクチャ

### 4.1 バックエンド構成

```
backend/
├── cmd/
│   ├── server/       # HTTPサーバーエントリポイント
│   ├── migrate/      # DBマイグレーション
│   └── seed/         # テストデータ投入
├── internal/
│   ├── domain/       # ドメインモデル（集約、エンティティ、値オブジェクト）
│   ├── app/          # アプリケーションサービス
│   ├── infra/        # インフラ層（リポジトリ実装）
│   └── interface/    # RESTハンドラー
```

### 4.2 ドメインモデル概念

```
テナント（Tenant）
    │
    ├── イベント（Event）
    │       │
    │       ├── 営業日（EventBusinessDay）
    │       │       │
    │       │       └── シフト枠（ShiftSlot）
    │       │               │
    │       │               └── シフト割り当て（ShiftAssignment）
    │       │
    │       └── 役職（Position）
    │
    └── メンバー（Member）
```

## 5. 制約と前提条件

### 5.1 業務制約

1. **テナント境界**: シフト情報は必ずひとつのテナントに属し、テナント間でのデータ混在は禁止
2. **イベントと営業日**: 営業日は必ずいずれかのイベントに所属する
3. **シフト枠の充足性**: 各営業日の各ポジションには「必要人数」が定義される

### 5.2 技術的前提

1. **タイムゾーン**: デフォルトでAsia/Tokyo（日本時間）を使用
2. **ID形式**: 全てのIDはULID（26文字）形式
3. **論理削除**: データは物理削除せず、`deleted_at`による論理削除を採用

