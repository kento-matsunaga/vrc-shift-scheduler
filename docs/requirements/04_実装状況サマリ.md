# 実装状況サマリ

## 1. 実装状況一覧

### 1.1 バックエンド

#### ドメインモデル

| コンポーネント | 実装状況 | ファイル | 備考 |
|---------------|---------|---------|------|
| Event（イベント） | ✅ 完了 | `domain/event/event.go` | 集約ルート |
| EventBusinessDay（営業日） | ✅ 完了 | `domain/event/event_business_day.go` | エンティティ |
| RecurringPattern（定期パターン） | ⚠️ 一部 | `domain/event/recurring_pattern.go` | 定義のみ |
| Member（メンバー） | ✅ 完了 | `domain/member/member.go` | 最小限実装 |
| Position（役職） | ✅ 完了 | `domain/shift/position.go` | エンティティ |
| ShiftSlot（シフト枠） | ✅ 完了 | `domain/shift/shift_slot.go` | エンティティ |
| ShiftAssignment（シフト割り当て） | ✅ 完了 | `domain/shift/shift_assignment.go` | エンティティ |
| Tenant（テナント） | ❌ 未実装 | - | DB定義のみ |
| Availability（シフト希望） | ❌ 未実装 | - | - |
| AttendanceCollection（出欠確認） | ❌ 未実装 | - | - |
| DateSchedule（日程調整） | ❌ 未実装 | - | - |
| MemberRole（メンバーロール） | ❌ 未実装 | - | - |
| ShiftPlan（シフト計画） | ❌ 未実装 | - | DB定義のみ |
| Notification（通知） | ❌ 未実装 | - | DB定義のみ |
| AuditLog（監査ログ） | ❌ 未実装 | - | DB定義のみ |

#### リポジトリ

| リポジトリ | 実装状況 | 備考 |
|-----------|---------|------|
| EventRepository | ✅ 完了 | CRUD実装 |
| BusinessDayRepository | ✅ 完了 | CRUD実装 |
| MemberRepository | ✅ 完了 | CRUD実装 |
| PositionRepository | ✅ 完了 | CRUD実装 |
| ShiftSlotRepository | ✅ 完了 | CRUD + 割り当て数取得 |
| ShiftAssignmentRepository | ✅ 完了 | CRUD + 複雑なクエリ |

#### REST API

| エンドポイント | メソッド | 実装状況 |
|---------------|---------|---------|
| `/health` | GET | ✅ |
| `/api/v1/events` | POST | ✅ |
| `/api/v1/events` | GET | ✅ |
| `/api/v1/events/{event_id}` | GET | ✅ |
| `/api/v1/events/{event_id}` | PUT | ❌ |
| `/api/v1/events/{event_id}` | DELETE | ❌ |
| `/api/v1/events/{event_id}/business-days` | POST | ✅ |
| `/api/v1/events/{event_id}/business-days` | GET | ✅ |
| `/api/v1/business-days/{business_day_id}` | GET | ✅ |
| `/api/v1/business-days/{business_day_id}/shift-slots` | POST | ✅ |
| `/api/v1/business-days/{business_day_id}/shift-slots` | GET | ✅ |
| `/api/v1/shift-slots/{slot_id}` | GET | ✅ |
| `/api/v1/members` | POST | ✅ |
| `/api/v1/members` | GET | ✅ |
| `/api/v1/members/{member_id}` | GET | ✅ |
| `/api/v1/shift-assignments` | POST | ✅ |
| `/api/v1/shift-assignments` | GET | ✅ |
| `/api/v1/shift-assignments/{assignment_id}` | GET | ✅ |

### 1.2 フロントエンド

#### ページ

| ページ | 実装状況 | ファイル | 機能 |
|-------|---------|---------|------|
| ログイン | ✅ 完了 | `pages/Login.tsx` | 簡易ログイン |
| イベント一覧 | ✅ 完了 | `pages/EventList.tsx` | 一覧表示、作成モーダル |
| 営業日一覧 | ✅ 完了 | `pages/BusinessDayList.tsx` | 一覧表示、作成 |
| シフト枠一覧 | ✅ 完了 | `pages/ShiftSlotList.tsx` | 一覧表示、作成 |
| シフト割り当て | ✅ 完了 | `pages/AssignShift.tsx` | メンバー選択、確定 |
| 自分のシフト | ✅ 完了 | `pages/MyShifts.tsx` | 割り当て一覧 |

#### 共通コンポーネント

| コンポーネント | 実装状況 | 備考 |
|---------------|---------|------|
| Layout | ✅ 完了 | ナビゲーション、ヘッダー |
| API Client | ✅ 完了 | fetch ラッパー、エラーハンドリング |

### 1.3 データベース

#### テーブル

| テーブル | 作成済み | 使用状況 |
|---------|---------|---------|
| tenants | ✅ | ⚠️ シードデータのみ |
| events | ✅ | ✅ 使用中 |
| recurring_patterns | ✅ | ❌ 未使用 |
| event_business_days | ✅ | ✅ 使用中 |
| members | ✅ | ✅ 使用中 |
| positions | ✅ | ✅ 使用中 |
| shift_slots | ✅ | ✅ 使用中 |
| shift_plans | ✅ | ⚠️ 簡易使用 |
| shift_assignments | ✅ | ✅ 使用中 |
| notification_logs | ✅ | ❌ 未使用 |
| notification_templates | ✅ | ❌ 未使用 |
| audit_logs | ✅ | ❌ 未使用 |

---

## 2. 機能別実装状況

```
[========================================] イベント管理      90%
[========================================] 営業日管理        85%
[========================================] シフト枠管理      80%
[====================================    ] シフト割り当て    70%
[========================================] メンバー管理      80%
[                                        ] シフト希望         0%
[                                        ] 出欠確認           0%
[                                        ] 日程調整           0%
[                                        ] 通知              0%
[                                        ] 監査ログ           0%
[                                        ] テナント管理       0%
[======                                  ] 認証・認可        15%
```

---

## 3. 今後のロードマップ

### Phase 1: MVP 完成（現在）

**目標**: 手動でのシフト管理が一通りできる状態

- [x] イベント CRUD
- [x] 営業日 CRUD
- [x] シフト枠 CRUD
- [x] メンバー CRUD
- [x] シフト割り当て（手動）
- [x] 自分のシフト確認
- [ ] イベント更新・削除
- [ ] シフト割り当てキャンセル

### Phase 2: 出欠確認・日程調整機能

**目標**: 調整さんのような公開URLで出欠確認・日程調整ができる

- [ ] AttendanceCollection ドメインモデル実装
- [ ] DateSchedule ドメインモデル実装
- [ ] 出欠確認 API 実装
- [ ] 日程調整 API 実装
- [ ] 公開回答ページ（フロントエンド）
- [ ] 管理画面（集計表示）
- [ ] Discord BOT連携（URL発行）

### Phase 3: シフト希望機能

**目標**: メンバーがシフト希望を提出でき、それに基づいて割り当てができる

- [ ] Availability ドメインモデル実装
- [ ] シフト希望 API 実装
- [ ] シフト希望提出画面
- [ ] 希望一覧・集計画面
- [ ] 希望締切機能

### Phase 4: 認証・権限管理

**目標**: セキュアな認証とロールベースの権限管理

- [ ] Discord OAuth 連携
- [ ] JWT セッション管理
- [ ] MemberRole ドメインモデル実装
- [ ] ロールベースアクセス制御（RBAC）
- [ ] テナント分離の認可

### Phase 5: 通知機能

**目標**: シフト関連の通知を自動送信

- [ ] Discord Webhook 連携
- [ ] シフト募集通知
- [ ] シフト確定通知
- [ ] 出勤リマインダー
- [ ] 緊急ヘルプ要請

### Phase 6: 監査・運用機能

**目標**: 運用に必要な監査・管理機能

- [ ] 監査ログ自動記録
- [ ] 操作履歴画面
- [ ] テナント管理画面
- [ ] 管理者ダッシュボード

### Phase 7: 高度な機能

**目標**: 運営効率を向上させる高度な機能

- [ ] 定期パターンからの営業日自動生成
- [ ] シフト自動割り当て
- [ ] シフト枠テンプレート
- [ ] レポート・分析機能

---

## 4. 技術的負債

### 4.1 優先度高

| 項目 | 説明 | 影響 |
|------|------|------|
| 認証の本格実装 | localStorage ベースの簡易認証 | セキュリティリスク |
| テナント分離 | APIレベルでの分離が不完全 | マルチテナント不可 |
| エラーハンドリング統一 | エラーレスポンス形式の統一 | フロントエンド連携 |

### 4.2 優先度中

| 項目 | 説明 | 影響 |
|------|------|------|
| テストカバレッジ | ドメインモデルのテストが不足 | 品質リスク |
| バリデーションメッセージ | 日本語メッセージ対応 | UX |
| ログ構造化 | 構造化ログへの移行 | 運用効率 |

### 4.3 優先度低

| 項目 | 説明 | 影響 |
|------|------|------|
| APIドキュメント | OpenAPI Spec 作成 | 開発効率 |
| フロントエンドテスト | コンポーネントテスト | 品質 |
| パフォーマンス最適化 | N+1 クエリ対策 | 大規模時の性能 |

---

## 5. ディレクトリ構成

```
vrc-shift-scheduler/
├── backend/
│   ├── cmd/
│   │   ├── server/           # HTTPサーバー
│   │   ├── migrate/          # マイグレーション
│   │   └── seed/             # シードデータ
│   └── internal/
│       ├── domain/           # ドメインモデル
│       │   ├── event/        # イベント関連
│       │   ├── member/       # メンバー関連
│       │   ├── shift/        # シフト関連
│       │   ├── common/       # 共通型
│       │   ├── auth/         # 認証（未使用）
│       │   ├── availability/ # シフト希望（未実装）
│       │   ├── notification/ # 通知（未実装）
│       │   └── tenant/       # テナント（未実装）
│       ├── app/              # アプリケーションサービス
│       ├── infra/
│       │   └── db/           # リポジトリ実装
│       │       └── migrations/ # SQLマイグレーション
│       └── interface/
│           └── rest/         # RESTハンドラー
├── web-frontend/
│   └── src/
│       ├── pages/            # ページコンポーネント
│       ├── components/       # 共通コンポーネント
│       ├── lib/              # APIクライアント
│       └── types/            # 型定義
├── docs/
│   ├── domain/               # ドメインドキュメント
│   ├── requirements/         # 要件定義（本ドキュメント）
│   └── ...
└── docker-compose.yml
```

