# 手動E2Eテスト用チェックリスト

## 概要

このドキュメントは、人間がブラウザで操作するための「動作確認チェックリスト」です。システム全体の主要機能を確認するための手順を、画面単位で整理しています。

---

## 1. 前提条件

### 1.1 起動方法

**ローカル開発モード**（Docker Compose 不使用）を前提とします。

#### バックエンド起動

```bash
cd backend
go run ./cmd/server/main.go
```

- **使用ポート**: `:8080`（デフォルト）
- **確認方法**: ブラウザで `http://localhost:8080/health` にアクセスし、`{"status":"ok"}` が返ることを確認

#### フロントエンド起動

```bash
cd web-frontend
npm install  # 初回のみ
npm run dev -- --port 5173
```

- **使用ポート**: `:5173`（デフォルト）
- **確認方法**: ブラウザで `http://localhost:5173` にアクセスし、ログイン画面が表示されることを確認

### 1.2 テストデータの準備

**テナントID**: テスト用のテナントID（ULID形式）を用意する必要があります。

- **方法1**: データベースに直接挿入
- **方法2**: シードコマンドを使用（実装されている場合）
- **方法3**: ログイン画面のURLパラメータで指定（例: `http://localhost:5173/login?tenant_id=01ARZ3NDEKTSV4RRFFQ69G5FAV`）

**注意**: テスト用のテナントIDは、事前にデータベースに存在している必要があります。

---

## 2. 管理者フロー（イベント作成 → 営業日作成 → シフト枠作成 → シフト割り当て）

### 2.1 ステップ1: ログイン画面

**URL**: `http://localhost:5173/login`

**操作手順**:

1. ブラウザで `http://localhost:5173/login` にアクセス
2. **テナントIDの設定**:
   - **方法A**: URLパラメータで指定（例: `http://localhost:5173/login?tenant_id=01ARZ3NDEKTSV4RRFFQ69G5FAV`）
   - **方法B**: 環境変数 `VITE_TENANT_ID` が設定されている場合、自動的に使用される
3. **表示名の入力**: テキストフィールドに表示名を入力（例: `テスト管理者`）
4. **ログインボタンをクリック**

**確認ポイント**:

- ✅ ログイン画面が表示される
- ✅ テナントIDが正しく設定されている（コンソールログで確認可能）
- ✅ 表示名を入力してログインボタンをクリックすると、エラーなくイベント一覧画面に遷移する
- ✅ ブラウザの開発者ツール（Network タブ）で、`POST /api/v1/members` リクエストが `http://localhost:8080` に送信されていることを確認
- ✅ レスポンスステータスが `201 Created` であることを確認

**期待される画面**: イベント一覧画面（`/events`）に遷移

---

### 2.2 ステップ2: イベント一覧画面

**URL**: `http://localhost:5173/events`

**操作手順**:

1. ログイン後、自動的にイベント一覧画面に遷移
2. **既存イベントの確認**:
   - 既存のイベントが一覧表示されているか確認
   - イベントがない場合は、新規作成ボタンをクリック
3. **新規イベント作成**:
   - 「新規作成」ボタンをクリック
   - モーダルダイアログが表示される
   - 以下の情報を入力:
     - **イベント名**: `テストイベント`（必須）
     - **イベント種別**: `通常営業` または `特別イベント`（必須）
     - **説明**: `これはテスト用のイベントです`（任意）
   - 「作成」ボタンをクリック
4. **作成結果の確認**:
   - モーダルが閉じる
   - イベント一覧に新しく作成したイベントが表示される

**確認ポイント**:

- ✅ イベント一覧が正しく表示される（ローディングスピナーが表示され、その後一覧が表示される）
- ✅ 新規作成ボタンをクリックすると、モーダルダイアログが表示される
- ✅ イベント名、イベント種別、説明を入力して作成ボタンをクリックすると、エラーなく作成される
- ✅ ブラウザの開発者ツール（Network タブ）で、`POST /api/v1/events` リクエストが送信されていることを確認
- ✅ レスポンスステータスが `201 Created` であることを確認
- ✅ 作成後、イベント一覧に新しいイベントが追加される

**期待される画面**: イベント一覧画面（新しく作成したイベントが表示される）

---

### 2.3 ステップ3: 営業日一覧画面

**URL**: `http://localhost:5173/events/:eventId/business-days`

**操作手順**:

1. イベント一覧画面で、作成したイベントの行をクリック（または「営業日」リンクをクリック）
2. **営業日一覧の確認**:
   - 既存の営業日が一覧表示されているか確認
   - 営業日がない場合は、新規作成ボタンをクリック
3. **新規営業日作成**:
   - 「営業日を追加」ボタンをクリック
   - モーダルダイアログが表示される
   - 以下の情報を入力:
     - **日付**: `2025-01-15`（必須、YYYY-MM-DD形式）
     - **開始時刻**: `21:30`（必須、HH:MM形式）
     - **終了時刻**: `23:00`（必須、HH:MM形式）
     - **種別**: `特別営業` または `定期営業`（必須）
   - 「作成」ボタンをクリック
4. **作成結果の確認**:
   - モーダルが閉じる
   - 営業日一覧に新しく作成した営業日が表示される

**確認ポイント**:

- ✅ 営業日一覧が正しく表示される（ローディングスピナーが表示され、その後一覧が表示される）
- ✅ 新規作成ボタンをクリックすると、モーダルダイアログが表示される
- ✅ 日付、開始時刻、終了時刻、種別を入力して作成ボタンをクリックすると、エラーなく作成される
- ✅ ブラウザの開発者ツール（Network タブ）で、`POST /api/v1/events/:eventId/business-days` リクエストが送信されていることを確認
- ✅ レスポンスステータスが `201 Created` であることを確認
- ✅ 作成後、営業日一覧に新しい営業日が追加される
- ✅ 日付、開始時刻、終了時刻が正しく表示される

**期待される画面**: 営業日一覧画面（新しく作成した営業日が表示される）

---

### 2.4 ステップ4: シフト枠一覧画面

**URL**: `http://localhost:5173/business-days/:businessDayId/shift-slots`

**操作手順**:

1. 営業日一覧画面で、作成した営業日の行をクリック（または「シフト枠」リンクをクリック）
2. **シフト枠一覧の確認**:
   - 既存のシフト枠が一覧表示されているか確認
   - シフト枠がない場合は、新規作成ボタンをクリック
3. **新規シフト枠作成**:
   - 「シフト枠を追加」ボタンをクリック
   - モーダルダイアログが表示される
   - 以下の情報を入力:
     - **役職名**: `スタッフ`（必須、既存のポジションIDを指定する必要がある）
     - **シフト枠名**: `早番スタッフ`（必須）
     - **インスタンス名**: `Instance A`（必須）
     - **開始時刻**: `21:30:00`（必須、HH:MM:SS形式）
     - **終了時刻**: `23:00:00`（必須、HH:MM:SS形式）
     - **必要人数**: `2`（必須、1以上）
     - **優先度**: `1`（任意、デフォルト: 0）
   - 「作成」ボタンをクリック
4. **作成結果の確認**:
   - モーダルが閉じる
   - シフト枠一覧に新しく作成したシフト枠が表示される

**確認ポイント**:

- ✅ シフト枠一覧が正しく表示される（ローディングスピナーが表示され、その後一覧が表示される）
- ✅ 新規作成ボタンをクリックすると、モーダルダイアログが表示される
- ✅ 役職名、シフト枠名、インスタンス名、開始時刻、終了時刻、必要人数を入力して作成ボタンをクリックすると、エラーなく作成される
- ✅ ブラウザの開発者ツール（Network タブ）で、`POST /api/v1/business-days/:businessDayId/shift-slots` リクエストが送信されていることを確認
- ✅ レスポンスステータスが `201 Created` であることを確認
- ✅ 作成後、シフト枠一覧に新しいシフト枠が追加される
- ✅ シフト枠名、開始時刻、終了時刻、必要人数が正しく表示される
- ⚠️ **注意**: `assigned_count` は現状常に `0` を返す（実装不足）

**期待される画面**: シフト枠一覧画面（新しく作成したシフト枠が表示される）

---

### 2.5 ステップ5: シフト割り当て画面

**URL**: `http://localhost:5173/shift-slots/:slotId/assign`

**操作手順**:

1. シフト枠一覧画面で、作成したシフト枠の行の「割り当て」ボタンをクリック
2. **シフト割り当て画面の確認**:
   - シフト枠の詳細情報が表示される
   - メンバー選択のプルダウンが表示される
3. **シフト割り当て**:
   - メンバー選択のプルダウンから、割り当てるメンバーを選択（例: `テスト管理者`）
   - **備考**（任意）: `テスト用の割り当てです` を入力
   - 「確定」ボタンをクリック
4. **割り当て結果の確認**:
   - 成功メッセージが表示される（または、シフト枠一覧画面に戻る）
   - シフト枠一覧画面で、割り当てたシフト枠の `assigned_count` が増えていることを確認（実装されていない場合は確認不可）

**確認ポイント**:

- ✅ シフト割り当て画面が正しく表示される（ローディングスピナーが表示され、その後詳細が表示される）
- ✅ シフト枠の詳細情報（シフト枠名、開始時刻、終了時刻、必要人数など）が正しく表示される
- ✅ メンバー選択のプルダウンに、メンバー一覧が表示される
- ✅ メンバーを選択して確定ボタンをクリックすると、エラーなく割り当てが確定される
- ✅ ブラウザの開発者ツール（Network タブ）で、以下のリクエストが送信されていることを確認:
  - `GET /api/v1/shift-slots/:slotId` - シフト枠詳細取得
  - `GET /api/v1/members` - メンバー一覧取得
  - `POST /api/v1/shift-assignments` - シフト割り当て確定
- ✅ レスポンスステータスが `201 Created` であることを確認
- ✅ 割り当て後、成功メッセージが表示される、またはシフト枠一覧画面に戻る

**期待される画面**: シフト割り当て画面（割り当て成功後、シフト枠一覧画面に戻る）

---

### 2.6 ステップ6: 自分のシフト一覧画面

**URL**: `http://localhost:5173/my-shifts`

**操作手順**:

1. ヘッダーの「自分のシフト」リンクをクリック（または、直接 `http://localhost:5173/my-shifts` にアクセス）
2. **シフト一覧の確認**:
   - 「今後のシフト」タブと「過去のシフト」タブが表示される
   - 先ほど割り当てたシフトが「今後のシフト」タブに表示されることを確認
3. **シフト詳細の確認**:
   - シフトの日付、時刻、役職、割り当て方法が正しく表示されることを確認

**確認ポイント**:

- ✅ 自分のシフト一覧画面が正しく表示される（ローディングスピナーが表示され、その後一覧が表示される）
- ✅ 「今後のシフト」タブと「過去のシフト」タブが表示される
- ✅ 先ほど割り当てたシフトが「今後のシフト」タブに表示される
- ✅ シフトの詳細情報（日付、時刻、役職、割り当て方法など）が正しく表示される
- ✅ ブラウザの開発者ツール（Network タブ）で、`GET /api/v1/shift-assignments?member_id=...&assignment_status=confirmed` リクエストが送信されていることを確認
- ✅ レスポンスステータスが `200 OK` であることを確認
- ⚠️ **注意**: 日付範囲フィルタ（`start_date`, `end_date`）は現状未実装のため、「今後のシフト」「過去のシフト」のフィルタリングが正しく動作しない可能性がある

**期待される画面**: 自分のシフト一覧画面（先ほど割り当てたシフトが表示される）

---

## 3. 一般メンバーフロー（ログイン → 自分のシフト確認）

### 3.1 ステップ1: ログイン画面

**URL**: `http://localhost:5173/login`

**操作手順**:

1. ブラウザで `http://localhost:5173/login` にアクセス
2. **テナントIDの設定**: 管理者フローと同じ
3. **表示名の入力**: 別の表示名を入力（例: `テストメンバー`）
4. **ログインボタンをクリック**

**確認ポイント**: 管理者フローと同じ

**期待される画面**: イベント一覧画面（`/events`）に遷移

---

### 3.2 ステップ2: 自分のシフト一覧画面

**URL**: `http://localhost:5173/my-shifts`

**操作手順**:

1. ヘッダーの「自分のシフト」リンクをクリック
2. **シフト一覧の確認**:
   - このメンバーに割り当てられたシフトがない場合、一覧が空であることを確認
   - 管理者が先ほど割り当てたシフトがある場合、そのシフトが表示されることを確認

**確認ポイント**: 管理者フローのステップ6と同じ

**期待される画面**: 自分のシフト一覧画面（割り当てられたシフトが表示される、または空の一覧）

---

## 4. エラーケースの確認

### 4.1 ログイン画面でのエラー

**テストケース1: 表示名が空**

- **操作**: 表示名を入力せずにログインボタンをクリック
- **期待結果**: エラーメッセージ「表示名を入力してください」が表示される

**テストケース2: テナントIDが設定されていない**

- **操作**: テナントIDを設定せずにログインボタンをクリック
- **期待結果**: エラーメッセージ「テナントIDが設定されていません。招待URLからアクセスしてください。」が表示される

---

### 4.2 イベント作成でのエラー

**テストケース1: イベント名が空**

- **操作**: イベント名を入力せずに作成ボタンをクリック
- **期待結果**: エラーメッセージが表示される（バリデーションエラー）

**テストケース2: 同じ名前のイベントを重複作成**

- **操作**: 既に存在するイベント名で新規作成を試みる
- **期待結果**: エラーメッセージ「Event with this name already exists」が表示される（409 Conflict）

---

### 4.3 シフト割り当てでのエラー

**テストケース1: 満員のシフト枠に割り当てを試みる**

- **前提**: `required_count` が `2` で、既に `2` 人割り当てられているシフト枠
- **操作**: 3人目の割り当てを試みる
- **期待結果**: エラーメッセージ「このシフト枠は既に満員です」が表示される（409 Conflict）

**注意**: 現状、`assigned_count` が実装されていないため、このテストケースは実行できない可能性がある。

---

## 5. まとめ

### 5.1 確認済み機能

- ✅ ログイン（表示名による簡易認証）
- ✅ イベント一覧表示・作成
- ✅ 営業日一覧表示・作成
- ✅ シフト枠一覧表示・作成
- ✅ シフト割り当て
- ✅ 自分のシフト一覧表示

### 5.2 既知の問題点

- ⚠️ **シフト枠の割り当て状況表示**: `assigned_count` が常に `0` を返す（実装不足）
- ⚠️ **自分のシフト一覧の日付範囲フィルタ**: `start_date`, `end_date` パラメータが未実装
- ⚠️ **シフト割り当ての詳細情報**: `member_display_name`, `slot_name`, `target_date`, `start_time`, `end_time` がレスポンスに含まれない（実装不足）

### 5.3 テスト実行時の注意点

1. **テナントIDの設定**: テスト用のテナントIDを事前に用意する必要がある
2. **データのクリーンアップ**: テスト実行後、テストデータを削除するか、テスト用のデータベースを使用する
3. **ブラウザの開発者ツール**: Network タブで API リクエスト・レスポンスを確認する
4. **エラーメッセージ**: エラーが発生した場合、ブラウザのコンソールログを確認する

---

**作成日**: 2025-01-XX  
**作成者**: 検証専用アシスタント（Auto）




