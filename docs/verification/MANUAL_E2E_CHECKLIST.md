# 手動E2Eテスト用チェックリスト

> 最終更新: 2025-12-19

## 概要

このドキュメントは、人間がブラウザで操作するための「動作確認チェックリスト」です。システム全体の主要機能を確認するための手順を、画面単位で整理しています。

---

## 1. 前提条件

### 1.1 起動方法

**ローカル開発モード**（Docker Compose 不使用）を前提とします。

#### バックエンド起動

```bash
cd backend
DATABASE_URL="postgres://vrcshift:vrcshift@localhost:5432/vrcshift?sslmode=disable" \
JWT_SECRET="your_secret_key" \
go run ./cmd/server/main.go
```

- **使用ポート**: `:8080`（デフォルト）
- **必須環境変数**: `DATABASE_URL`, `JWT_SECRET`
- **確認方法**: ブラウザで `http://localhost:8080/health` にアクセスし、`{"status":"ok"}` が返ることを確認

#### フロントエンド起動

```bash
cd web-frontend
npm install  # 初回のみ
npm run dev
```

- **使用ポート**: `:5173`（デフォルト）
- **確認方法**: ブラウザで `http://localhost:5173` にアクセスし、ログイン画面が表示されることを確認

### 1.2 テストデータの準備

シードデータを投入することで、テスト用のテナント、管理者、メンバー、ロール、ポジションが作成されます。

```bash
cd backend
DATABASE_URL="postgres://vrcshift:vrcshift@localhost:5432/vrcshift?sslmode=disable" \
./bin/seed
```

**テスト用アカウント**:

| メール | パスワード | ロール |
|--------|-----------|--------|
| admin@example.com | password123 | owner |

---

## 2. 管理者フロー（ログイン → イベント作成 → 営業日作成 → シフト枠作成 → シフト割り当て）

### 2.1 ステップ1: ログイン画面

**URL**: `http://localhost:5173/login`

**操作手順**:

1. ブラウザで `http://localhost:5173/login` にアクセス
2. **認証情報の入力**:
   - **メールアドレス**: `admin@example.com`
   - **パスワード**: `password123`
3. **ログインボタンをクリック**

**確認ポイント**:

- ✅ ログイン画面が表示される
- ✅ メールアドレスとパスワードを入力してログインボタンをクリックすると、エラーなくダッシュボードに遷移する
- ✅ ブラウザの開発者ツール（Network タブ）で、`POST /api/v1/auth/login` リクエストが `http://localhost:8080` に送信されていることを確認
- ✅ レスポンスステータスが `200 OK` であることを確認
- ✅ レスポンスに `access_token` が含まれることを確認
- ✅ 以降のAPIリクエストに `Authorization: Bearer <token>` ヘッダーが付与されていることを確認

**期待される画面**: ダッシュボードまたはイベント一覧画面に遷移

---

### 2.2 ステップ2: イベント一覧画面

**URL**: `http://localhost:5173/events`

**操作手順**:

1. ログイン後、自動的にイベント一覧画面に遷移（またはサイドメニューから「イベント」をクリック）
2. **既存イベントの確認**:
   - 既存のイベントが一覧表示されているか確認
   - イベントがない場合は、新規作成ボタンをクリック
3. **新規イベント作成**:
   - 「新規作成」ボタンをクリック
   - モーダルダイアログが表示される
   - 以下の情報を入力:
     - **イベント名**: `テストイベント`（必須）
     - **イベント種別**: `通常営業` または `特別イベント`（必須）
     - **説明**: `これはテスト用のイベントです`（任意）
     - **定期パターン**（任意）: 毎週○曜日
   - 「作成」ボタンをクリック
4. **作成結果の確認**:
   - モーダルが閉じる
   - イベント一覧に新しく作成したイベントが表示される

**確認ポイント**:

- ✅ イベント一覧が正しく表示される
- ✅ 新規作成ボタンをクリックすると、モーダルダイアログが表示される
- ✅ イベント名、イベント種別、説明を入力して作成ボタンをクリックすると、エラーなく作成される
- ✅ ブラウザの開発者ツール（Network タブ）で、`POST /api/v1/events` リクエストが送信されていることを確認
- ✅ レスポンスステータスが `201 Created` であることを確認
- ✅ 作成後、イベント一覧に新しいイベントが追加される

**期待される画面**: イベント一覧画面（新しく作成したイベントが表示される）

---

### 2.3 ステップ3: 営業日一覧画面

**URL**: `http://localhost:5173/events/:eventId/business-days`

**操作手順**:

1. イベント一覧画面で、作成したイベントの行をクリック（または「営業日」リンクをクリック）
2. **営業日一覧の確認**:
   - 月次カレンダー形式で営業日が表示される
   - 既存の営業日がない場合は、新規作成ボタンをクリック
3. **新規営業日作成**:
   - 「営業日を追加」ボタンをクリック
   - モーダルダイアログが表示される
   - 以下の情報を入力:
     - **日付**: 今日以降の日付（必須）
     - **開始時刻**: `21:00`（必須）
     - **終了時刻**: `23:30`（必須）
   - 「追加」ボタンをクリック
4. **作成結果の確認**:
   - モーダルが閉じる
   - 営業日一覧に新しく作成した営業日が表示される

**確認ポイント**:

- ✅ 営業日一覧が月次カレンダー形式で正しく表示される
- ✅ 月選択UIで月を切り替えられる
- ✅ 新規作成ボタンをクリックすると、モーダルダイアログが表示される
- ✅ 日付、開始時刻、終了時刻を入力して作成ボタンをクリックすると、エラーなく作成される
- ✅ ブラウザの開発者ツール（Network タブ）で、`POST /api/v1/events/:eventId/business-days` リクエストが送信されていることを確認
- ✅ レスポンスステータスが `201 Created` であることを確認

**期待される画面**: 営業日一覧画面（新しく作成した営業日が表示される）

---

### 2.4 ステップ4: シフト枠一覧画面

**URL**: `http://localhost:5173/business-days/:businessDayId/shift-slots`

**操作手順**:

1. 営業日一覧画面で、作成した営業日の行をクリック（または「シフト枠」リンクをクリック）
2. **シフト枠一覧の確認**:
   - 既存のシフト枠が一覧表示されているか確認
   - シフト枠がない場合は、新規作成ボタンをクリック
3. **新規シフト枠作成**:
   - 「シフト枠を追加」ボタンをクリック
   - モーダルダイアログが表示される
   - 以下の情報を入力:
     - **ポジション**: ドロップダウンから選択（必須）
     - **シフト枠名**: `受付A`（必須）
     - **インスタンス名**: `VRChat Japan`（任意）
     - **開始時刻**: `21:00`（必須）
     - **終了時刻**: `22:00`（必須）
     - **必要人数**: `2`（必須、1以上）
     - **優先度**: `1`（任意）
   - 「追加」ボタンをクリック
4. **作成結果の確認**:
   - モーダルが閉じる
   - シフト枠一覧に新しく作成したシフト枠が表示される
   - **割り当て状況が「0/2」のように表示される**

**確認ポイント**:

- ✅ シフト枠一覧が正しく表示される
- ✅ 新規作成ボタンをクリックすると、モーダルダイアログが表示される
- ✅ ポジション、シフト枠名、開始時刻、終了時刻、必要人数を入力して作成ボタンをクリックすると、エラーなく作成される
- ✅ ブラウザの開発者ツール（Network タブ）で、`POST /api/v1/business-days/:businessDayId/shift-slots` リクエストが送信されていることを確認
- ✅ レスポンスステータスが `201 Created` であることを確認
- ✅ **割り当て状況（assigned_count / required_count）が正しく表示される**

**期待される画面**: シフト枠一覧画面（新しく作成したシフト枠が表示される）

---

### 2.5 ステップ5: シフト割り当て画面

**URL**: `http://localhost:5173/shift-slots/:slotId/assign`

**操作手順**:

1. シフト枠一覧画面で、作成したシフト枠の行の「割り当て」ボタンをクリック
2. **シフト割り当て画面の確認**:
   - シフト枠の詳細情報が表示される
   - メンバー選択のプルダウンが表示される
3. **シフト割り当て**:
   - メンバー選択のプルダウンから、割り当てるメンバーを選択
   - **備考**（任意）: `テスト用の割り当てです` を入力
   - 「確定」ボタンをクリック
4. **割り当て結果の確認**:
   - 成功メッセージが表示される
   - シフト枠一覧画面で、割り当て状況が「1/2」に更新されていることを確認

**確認ポイント**:

- ✅ シフト割り当て画面が正しく表示される
- ✅ シフト枠の詳細情報（シフト枠名、開始時刻、終了時刻、必要人数など）が正しく表示される
- ✅ メンバー選択のプルダウンに、メンバー一覧が表示される（ロール情報も表示される）
- ✅ メンバーを選択して確定ボタンをクリックすると、エラーなく割り当てが確定される
- ✅ ブラウザの開発者ツール（Network タブ）で、以下のリクエストが送信されていることを確認:
  - `GET /api/v1/shift-slots/:slotId` - シフト枠詳細取得
  - `GET /api/v1/members` - メンバー一覧取得（ロール情報含む）
  - `POST /api/v1/shift-assignments` - シフト割り当て確定
- ✅ レスポンスステータスが `201 Created` であることを確認
- ✅ 割り当て後、成功メッセージが表示される

**期待される画面**: シフト割り当て画面（割り当て成功後、シフト枠一覧画面に戻る）

---

### 2.6 ステップ6: シフト割り当て一覧確認

**URL**: APIリクエストで確認

**操作手順**:

1. ブラウザの開発者ツール（Console タブ）で以下を実行して確認:

```javascript
// メンバーIDでフィルタ
fetch('/api/v1/shift-assignments?member_id=<MEMBER_ID>', {
  headers: { 'Authorization': 'Bearer <TOKEN>' }
}).then(r => r.json()).then(console.log)

// 日付範囲でフィルタ
fetch('/api/v1/shift-assignments?member_id=<MEMBER_ID>&start_date=2025-01-01&end_date=2025-12-31', {
  headers: { 'Authorization': 'Bearer <TOKEN>' }
}).then(r => r.json()).then(console.log)
```

**確認ポイント**:

- ✅ レスポンスに `member_display_name` が含まれる
- ✅ レスポンスに `slot_name` が含まれる
- ✅ レスポンスに `target_date` が含まれる
- ✅ レスポンスに `start_time`, `end_time` が含まれる
- ✅ `start_date`, `end_date` パラメータでフィルタリングが正しく動作する

---

## 3. メンバー管理フロー

### 3.1 メンバー一覧画面

**URL**: `http://localhost:5173/members`

**操作手順**:

1. サイドメニューから「メンバー」をクリック
2. **メンバー一覧の確認**:
   - 既存のメンバーが一覧表示される
   - 各メンバーにロールが表示される
3. **新規メンバー作成**:
   - 「新規登録」ボタンをクリック
   - 以下の情報を入力:
     - **表示名**: `テストメンバー`（必須）
   - 「登録」ボタンをクリック

**確認ポイント**:

- ✅ メンバー一覧が正しく表示される
- ✅ 各メンバーにロール情報が表示される（ロールがある場合）
- ✅ 新規メンバーを作成できる
- ✅ メンバーにロールを割り当てられる

---

## 4. 出欠確認・日程調整フロー

### 4.1 出欠確認管理

**URL**: `http://localhost:5173/attendance`

**操作手順**:

1. サイドメニューから「出欠確認」をクリック
2. **出欠確認の作成**:
   - 「新規作成」ボタンをクリック
   - タイトル、説明、対象イベントを入力
   - 「作成」ボタンをクリック
3. **公開URLの確認**:
   - 作成した出欠確認の詳細画面で公開URLを確認
   - 公開URLをコピー

**確認ポイント**:

- ✅ 出欠確認を作成できる
- ✅ 公開URL（UUID v4形式のトークン）が発行される
- ✅ 公開URLでアクセスすると、認証なしで回答画面が表示される

### 4.2 日程調整管理

**URL**: `http://localhost:5173/schedules`

**操作手順**:

1. サイドメニューから「日程調整」をクリック
2. **日程調整の作成**:
   - 「新規作成」ボタンをクリック
   - タイトル、説明、候補日を入力
   - 「作成」ボタンをクリック
3. **公開URLの確認**:
   - 作成した日程調整の詳細画面で公開URLを確認

**確認ポイント**:

- ✅ 日程調整を作成できる
- ✅ 候補日を設定できる
- ✅ 公開URLでアクセスすると、認証なしで回答画面が表示される

---

## 5. エラーケースの確認

### 5.1 ログイン画面でのエラー

**テストケース1: パスワードが間違っている**

- **操作**: 正しいメールアドレスと間違ったパスワードでログインを試みる
- **期待結果**: エラーメッセージが表示される（401 Unauthorized）

**テストケース2: 存在しないメールアドレス**

- **操作**: 存在しないメールアドレスでログインを試みる
- **期待結果**: エラーメッセージが表示される

---

### 5.2 シフト割り当てでのエラー

**テストケース1: 満員のシフト枠に割り当てを試みる**

- **前提**: `required_count` が `2` で、既に `2` 人割り当てられているシフト枠
- **操作**: 3人目の割り当てを試みる
- **期待結果**: エラーメッセージ「このシフト枠は既に満員です」が表示される（409 Conflict）

**テストケース2: 同じメンバーを重複して割り当てを試みる**

- **前提**: 既にメンバーAが割り当てられているシフト枠
- **操作**: 同じメンバーAを再度割り当てを試みる
- **期待結果**: エラーメッセージが表示される（409 Conflict）

---

## 6. まとめ

### 6.1 確認済み機能

- ✅ ログイン（JWT認証、email/password）
- ✅ イベント一覧表示・作成・編集・削除
- ✅ 営業日一覧表示・作成・編集・削除（月次カレンダー表示）
- ✅ シフト枠一覧表示・作成・編集・削除
- ✅ シフトテンプレートからの一括作成
- ✅ シフト割り当て・キャンセル
- ✅ シフト枠の割り当て状況表示（X/Y人）
- ✅ メンバー管理（ロール情報含む）
- ✅ ロール管理
- ✅ 出欠確認（公開URL対応）
- ✅ 日程調整（公開URL対応）

### 6.2 API機能確認

- ✅ `assigned_count` が正しく返される（JOINで取得）
- ✅ `start_date`, `end_date` パラメータによる日付範囲フィルタが動作
- ✅ `member_display_name`, `slot_name`, `target_date`, `start_time`, `end_time` がレスポンスに含まれる
- ✅ メンバー取得時にロール情報が含まれる

### 6.3 テスト実行時の注意点

1. **環境変数の設定**: `DATABASE_URL` と `JWT_SECRET` が必須
2. **シードデータの投入**: テスト用アカウントを使用するためにシードデータを投入
3. **ブラウザの開発者ツール**: Network タブで API リクエスト・レスポンスを確認する
4. **エラーメッセージ**: エラーが発生した場合、ブラウザのコンソールログを確認する

---

**作成日**: 2025-12-19
**更新者**: ドキュメント検証
